<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä¾‹äº”ï¼šç”Ÿå‘½æœ«æœŸçš„æ‹”æ²³ (é‚è¼¯ä¿®æ­£ç‰ˆ)</title>
    <style>
        :root { --bg-color: #1a1a1a; --left-bg: #ffffff; --right-bg: #2c3e50; --text-main: #2c3e50; --text-light: #ffffff; --highlight: #27ae60; --btn-blue: #16a085; --nurse-bg: #d4efdf; --npc-bg: #f2f3f4; --jit-bg: rgba(243, 156, 18, 0.25); --jit-border: #d35400; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; -webkit-font-smoothing: antialiased; }
        #stage-container { width: 100vw; height: 100vh; background-color: #fff; display: flex; flex-direction: row; position: relative; }
        #story-panel { width: 60%; background-color: var(--left-bg); display: flex; flex-direction: column; padding: 20px; border-right: 5px solid #bdc3c7; position: relative; }
        #mood-badge { position: absolute; top: 20px; left: 20px; background-color: #7f8c8d; color: white; padding: 10px 30px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; z-index: 5; }
        #vocab-btn { position: absolute; top: 20px; right: 20px; background-color: var(--highlight); color: #fff; border: 3px solid #fff; padding: 10px 20px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; z-index: 100; transition: transform 0.2s; }
        #vocab-btn:hover { transform: scale(1.05); }
        #dialogue-box { flex: 1; overflow-y: auto; padding: 80px 20px 20px 20px; display: flex; flex-direction: column; gap: 25px; scroll-behavior: smooth; }
        .msg { max-width: 90%; padding: 25px 35px; border-radius: 20px; font-size: 2rem; line-height: 1.6; animation: fadeIn 0.5s ease; position: relative; }
        .msg-npc { align-self: flex-start; background-color: var(--npc-bg); border-left: 10px solid #7f8c8d; }
        .msg-player { align-self: flex-end; background-color: var(--nurse-bg); border-right: 10px solid #27ae60; }
        .msg strong { display: block; font-size: 1.6rem; margin-bottom: 10px; opacity: 0.8; }
        .jit-term { color: var(--text-main); background-color: var(--jit-bg); border-bottom: 2px solid var(--jit-border); padding: 2px 5px; border-radius: 4px; cursor: help; transition: all 0.2s; display: inline-block; }
        .jit-term:hover { background-color: rgba(243, 156, 18, 0.5); color: #000; }
        #global-tooltip { position: fixed; display: none; background-color: #34495e; color: #fff; padding: 20px; border-radius: 12px; max-width: 350px; font-size: 1.4rem; line-height: 1.5; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 9999; border: 2px solid #fff; pointer-events: none; opacity: 0; transition: opacity 0.2s ease; }
        #global-tooltip strong { display: block; color: #f1c40f; font-size: 1.6rem; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }
        #analysis-panel { width: 40%; background-color: var(--right-bg); color: var(--text-light); display: flex; flex-direction: column; padding: 30px; overflow-y: auto; }
        .section-box { margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; border-left: 6px solid var(--highlight); flex-shrink: 0; }
        .section-title { font-size: 1.4rem; color: var(--highlight); font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        .section-content { font-size: 1.5rem; line-height: 1.6; color: #fff; }
        .ui-hint { text-align: center; color: rgba(255,255,255,0.7); font-size: 1rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; flex-shrink: 0; }
        #controls-area { margin-top: auto; display: flex; flex-direction: column; gap: 20px; padding-bottom: 50px; flex-shrink: 0; }
        .btn { background-color: var(--btn-blue); color: white; border: 2px solid rgba(255,255,255,0.2); padding: 25px; font-size: 1.8rem; border-radius: 15px; cursor: pointer; text-align: left; }
        .btn:hover { background-color: #117a65; transform: translateY(-2px); }
        #feedback-box { display: none; background: #27ae60; color: white; padding: 20px; border-radius: 10px; font-size: 1.6rem; margin-top: 20px; margin-bottom: 20px; text-align: center; border: 3px solid white; flex-shrink: 0; }
        #vocab-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
        #vocab-content { background-color: #fff; width: 80%; max-width: 900px; max-height: 85vh; overflow-y: auto; border-radius: 20px; padding: 40px; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        #vocab-content h2 { color: #2c3e50; border-bottom: 3px solid var(--highlight); padding-bottom: 10px; }
        .vocab-item { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .vocab-term { font-size: 1.8rem; font-weight: bold; color: #2980b9; margin-bottom: 5px; }
        .vocab-def { font-size: 1.5rem; color: #555; line-height: 1.6; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 3rem; color: #999; cursor: pointer; line-height: 1; }
        @media (max-width: 1024px) or (orientation: portrait) {
            body { overflow-y: auto; height: auto; }
            #stage-container { flex-direction: column; height: auto; width: 100%; }
            #story-panel { width: 100%; height: 50vh; border-right: none; border-bottom: 5px solid #bdc3c7; }
            #analysis-panel { width: 100%; min-height: 50vh; padding: 20px; padding-bottom: 80px; }
            .msg { font-size: 1.3rem; padding: 15px; } .btn { font-size: 1.4rem; padding: 15px; }
            #global-tooltip { max-width: 80%; font-size: 1.2rem; bottom: 20px !important; top: auto !important; left: 50% !important; transform: translateX(-50%); }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div id="global-tooltip"></div>
<div id="vocab-modal">
    <div id="vocab-content"><span class="close-btn" onclick="toggleVocab()">Ã—</span><h2>ğŸ“– å°ˆæ¥­è©å½™é€ŸæŸ¥</h2>
        <div class="vocab-item"><div class="vocab-term">AD (é ç«‹é†«ç™‚æ±ºå®š)</div><div class="vocab-def">Advance Decisionã€‚æ°‘çœ¾åœ¨æ„è­˜æ¸…é†’æ™‚ï¼Œä»¥æ›¸é¢é å…ˆæ±ºå®šç‰¹å®šè‡¨åºŠæ¢ä»¶ä¸‹çš„é†«ç™‚æ„é¡˜ã€‚é ˆç¶“ ACP èˆ‡è¦‹è­‰æ‰ç”Ÿæ•ˆã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">ACP (é ç«‹é†«ç™‚ç…§è­·è«®å•†)</div><div class="vocab-def">Advance Care Planningã€‚æ„é¡˜äººèˆ‡é†«ç™‚åœ˜éšŠã€è¦ªå±¬å…±åŒè¨è«–ã€ç†è§£ä¸¦é”æˆå…±è­˜çš„æºé€šéç¨‹ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">DNR</div><div class="vocab-def">Do Not Resuscitateã€‚ä¸æ–½è¡Œå¿ƒè‚ºå¾©ç”¦è¡“ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">AAD (è‡ªå‹•å‡ºé™¢)</div><div class="vocab-def">Against Advice Dischargeã€‚ç—…äºº/å®¶å±¬é•èƒŒé†«ç™‚å»ºè­°ï¼Œå …æŒè¾¦ç†å‡ºé™¢ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">ç„¡æ•ˆé†«ç™‚</div><div class="vocab-def">Medical Futilityã€‚æ²»ç™‚ç„¡æ³•é”æˆç”Ÿç†æˆ–ç—…äººç›®æ¨™ï¼Œåªæœƒå»¶é•·æ­»äº¡éç¨‹ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">ä¸é›¢æ£„</div><div class="vocab-def">Non-abandonmentã€‚å³ä½¿ä¸æ€¥æ•‘ï¼Œä»æ‰¿è«¾æä¾›èˆ’é©è­·ç†èˆ‡é™ªä¼´ã€‚</div></div>
    </div>
</div>
<div id="stage-container">
    <button id="vocab-btn" onclick="toggleVocab()">ğŸ“– çŸ¥è­˜é€ŸæŸ¥</button>
    <div id="story-panel"><div id="mood-badge">Segment 1</div><div id="dialogue-box"></div></div>
    <div id="analysis-panel">
        <div class="ui-hint">ğŸ’¡ æç¤ºï¼šé»æ“Š <span class="jit-term" data-def="JIT: Just-in-Time Learning">æ©˜è‰²è¢å…‰å­—</span> å¯å³æ™‚æŸ¥çœ‹å®šç¾©</div>
        <div class="section-box"><div class="section-title">ğŸ¯ Objectives</div><div class="section-content" id="obj-text"></div></div>
        <div class="section-box"><div class="section-title">â“ Question</div><div class="section-content" id="question-text"></div></div>
        <div class="section-box"><div class="section-title">ğŸ“ Task</div><div class="section-content" id="task-text"></div></div>
        <div id="feedback-box"></div><div id="controls-area"></div>
    </div>
</div>
<script>
    const chatBox = document.getElementById('dialogue-box'); const controls = document.getElementById('controls-area'); const moodBadge = document.getElementById('mood-badge'); const objText = document.getElementById('obj-text'); const qText = document.getElementById('question-text'); const taskText = document.getElementById('task-text'); const feedbackBox = document.getElementById('feedback-box'); const vocabModal = document.getElementById('vocab-modal'); const tooltip = document.getElementById('global-tooltip');
    function toggleVocab() { vocabModal.style.display = vocabModal.style.display === 'flex' ? 'none' : 'flex'; }
    function enableJIT() { const terms = document.querySelectorAll('.jit-term'); terms.forEach(term => { term.addEventListener('mouseenter', (e) => showTooltip(e, term)); term.addEventListener('mousemove', (e) => moveTooltip(e)); term.addEventListener('mouseleave', hideTooltip); term.addEventListener('click', (e) => showTooltip(e, term)); }); }
    function showTooltip(e, term) { const def = term.getAttribute('data-def'); const title = term.innerText; tooltip.innerHTML = `<strong>${title}</strong>${def}`; tooltip.style.display = 'block'; requestAnimationFrame(() => { tooltip.style.opacity = '1'; moveTooltip(e); }); }
    function moveTooltip(e) { const w = window.innerWidth; const h = window.innerHeight; let x = e.clientX + 15; let y = e.clientY + 15; if (x + 300 > w) x = e.clientX - 320; if (y + 150 > h) y = e.clientY - 160; if(w > 1024) { tooltip.style.left = x + 'px'; tooltip.style.top = y + 'px'; } }
    function hideTooltip() { tooltip.style.opacity = '0'; setTimeout(() => { tooltip.style.display = 'none'; }, 200); }

    const scenes = {
        start: { 
            segment: "Segment 1: å€«ç†æ•æ„Ÿåº¦", 
            objectives: "è¾¨è­˜æ³•å¾‹èˆ‡è¦ªæƒ…çš„è¡çª", 
            questions: "ç•¶ç—…äººæœ‰ ADï¼Œä½†å®¶å±¬è¦æ±‚æ€¥æ•‘ï¼Œè©²è½èª°çš„ï¼Ÿ", 
            tasks: "è«‹åˆ†æï¼šå€«ç†è¡çªçš„æ ¸å¿ƒæ˜¯ä»€éº¼ï¼Ÿ", 
            messages: [
                { role: "system", text: "ã€æƒ…å¢ƒã€‘88æ­²é™³çˆºçˆº<span class='jit-term' data-def='Multiple Organ Failureï¼šå…©å€‹æˆ–ä»¥ä¸Šå™¨å®˜ç³»çµ±åŠŸèƒ½è¡°ç«­ã€‚'>å¤šé‡å™¨å®˜è¡°ç«­</span>ï¼Œæ„è­˜ä¸æ¸…ã€‚ç—…æ­·è¨»è¨˜å·²ç°½ç½² <span class='jit-term' data-def='AD (Advance Decision)ï¼šé ç«‹é†«ç™‚æ±ºå®šã€‚ç—…äººæ¸…é†’æ™‚æ›¸é¢é ç«‹çš„æ„é¡˜ã€‚'>AD</span> èˆ‡ <span class='jit-term' data-def='DNR (Do Not Resuscitate)ï¼šä¸æ–½è¡Œå¿ƒè‚ºå¾©ç”¦è¡“ã€‚'>DNR</span>ã€‚" }, 
                { role: "npc", name: "é™³å…ˆç”Ÿ (å…’å­)", text: "çˆ¸ï¼ä½ ä¸èƒ½èµ°ï¼è­·ç†å¸«ï¼Œå¿«é»æ’ç®¡ï¼æˆ‘æœ‰éŒ¢ï¼Œæ•‘åˆ°åº•ï¼" },
                { role: "player", text: "ï¼ˆçˆºçˆºå·²å®Œæˆ <span class='jit-term' data-def='ACP (Advance Care Planning)ï¼šé ç«‹é†«ç™‚ç…§è­·è«®å•†ã€‚'>ACP</span> ä¸¦è¨»è¨˜ï¼Œä½†å…’å­ç¾åœ¨æƒ…ç·’å¤±æ§...ï¼‰" }
            ], 
            choices: [
                { text: "A. é †å¾å®¶å±¬ï¼šé¿å…<span class='jit-term' data-def='Medical Disputeï¼šç—…äºº/å®¶å±¬å°é†«ç™‚éç¨‹ä¸æ»¿è€Œç”¢ç”Ÿçš„çˆ­è­°ã€‚'>é†«ç™‚ç³¾ç´›</span>ï¼Œå…ˆæ€¥æ•‘ã€‚", next: "wrong_s1" }, 
                { text: "B. å …æŒå€«ç†ï¼šè¾¨è­˜é€™æ˜¯<span class='jit-term' data-def='Autonomy (è‡ªä¸»åŸå‰‡)ï¼šå°Šé‡ç—…äººè‡ªæˆ‘æ±ºå®šçš„æ¬Šåˆ©ã€‚'>ç—…äººè‡ªä¸»</span>èˆ‡<span class='jit-term' data-def='å®¶å±¬çš„ä¸æ¨èˆ‡ç½ªæƒ¡æ„Ÿï¼Œå¸¸è¡¨ç¾ç‚ºè¦æ±‚éåº¦é†«ç™‚ã€‚'>å®¶å±¬æƒ…ç·’</span>çš„è¡çªã€‚", next: "correct_s1" }
            ] 
        },
        wrong_s1: { feedback: "âš ï¸ æç¤ºï¼šç—…äººå·²ç°½ç½²å…·æ³•å¾‹æ•ˆåŠ›çš„ AD/DNRã€‚è‹¥å› å®¶å±¬å£“åŠ›è€Œæ’ç®¡ï¼Œé•å Autonomy (è‡ªä¸»åŸå‰‡)ï¼Œä¹Ÿå¯èƒ½æ§‹æˆå°ç—…äººçš„å‚·å®³(ç„¡æ•ˆé†«ç™‚)ã€‚", repeat_scene: "start" },
        correct_s1: { feedback: "ğŸ‰ æ­£ç¢ºï¼æ ¸å¿ƒåœ¨æ–¼ã€Œç—…äººéå¾€æ„é¡˜ (AD)ã€èˆ‡ã€Œå®¶å±¬ç•¶ä¸‹æƒ…ç·’ã€çš„ä¸ä¸€è‡´ã€‚", next_scene: "seg2_intro" },
        
        seg2_intro: { 
            segment: "Segment 2: å€«ç†æ¨ç†", 
            objectives: "è©•ä¼°é†«ç™‚ç„¡æ•ˆæ€§", 
            questions: "æ’ç®¡æ˜¯æ•‘å‘½é‚„æ˜¯æŠ˜ç£¨ï¼Ÿ", 
            tasks: "è«‹æ¬Šè¡¡ã€Œ<span class='jit-term' data-def='Medical Indicationsï¼šé†«ç™‚è™•ç½®çš„å¿…è¦æ€§èˆ‡æœ‰æ•ˆæ€§ã€‚'>é†«ç™‚é©æ‡‰ç—‡</span>ã€èˆ‡ã€Œ<span class='jit-term' data-def='Non-maleficence (ä¸å‚·å®³åŸå‰‡)ï¼šä¸é€ æˆç—…äººèº«å¿ƒå‚·å®³ã€‚'>ä¸å‚·å®³åŸå‰‡</span>ã€ã€‚", 
            messages: [
                { role: "system", text: "ã€æ¼”è®Šã€‘é™³å…ˆç”ŸæŠ“ä½æ‚¨çš„æ‰‹ï¼šã€Œæˆ‘ä¸èƒ½ä¸å­ï¼ä¸€å®šè¦æ•‘ï¼ã€" }, 
                { role: "player", text: "ï¼ˆçˆºçˆºç‹€æ³æ¥µå·®ï¼ŒCPR æœƒå£“æ–·è‚‹éª¨ï¼Œä¸”ç„¡æ³•é€†è½‰æ­»äº¡...ï¼‰" }
            ], 
            choices: [
                { text: "A. åˆ¤å®šç‚º<span class='jit-term' data-def='Medical Futility (ç„¡æ•ˆé†«ç™‚)ï¼šæ²»ç™‚ç„¡æ³•é”æˆç”Ÿç†ç›®æ¨™ï¼Œåªæœƒå»¶é•·æ­»äº¡éç¨‹ã€‚'>ç„¡æ•ˆé†«ç™‚</span>ï¼šæ’ç®¡é•å Non-maleficence (ä¸å‚·å®³åŸå‰‡)ã€‚", next: "correct_s2" }, 
                { text: "B. åˆ¤å®šç‚º <span class='jit-term' data-def='Beneficence (è¡Œå–„åŸå‰‡)ï¼šæ¡å–å°ç—…äººæœ‰ç›Šçš„è¡Œå‹•ã€‚'>è¡Œå–„åŸå‰‡</span>ï¼šæœ‰ä¸€ç·šå¸Œæœ›å°±è¦åšï¼Œé€™æ˜¯å°Šé‡ç”Ÿå‘½ã€‚", next: "wrong_s2" }
            ] 
        },
        wrong_s2: { feedback: "âš ï¸ é·¹æ¶ï¼šBeneficence (è¡Œå–„) ä¸ç­‰æ–¼åšæ‰€æœ‰è™•ç½®ã€‚è‹¥è™•ç½®åªæœƒå¢åŠ ç—›è‹¦è€Œç„¡æ²»ç™’å¸Œæœ›ï¼Œé‚£å°±æ˜¯ Maleficence (å‚·å®³)ã€‚å–„çµ‚ä¹Ÿæ˜¯è¡Œå–„ã€‚", repeat_scene: "seg2_intro" },
        correct_s2: { feedback: "ğŸ‰ æ¨ç†æ­£ç¢ºï¼åŸºæ–¼ Non-maleficence (ä¸å‚·å®³) èˆ‡ Autonomy (è‡ªä¸»)ï¼Œä¸æ‡‰åŸ·è¡Œç„¡æ•ˆä¸”é•èƒŒæ„é¡˜çš„æ€¥æ•‘ã€‚", next_scene: "seg3_intro" },
        
        seg3_intro: { 
            segment: "Segment 3: å°ˆæ¥­è¡Œå‹•", 
            objectives: "åŸ·è¡Œå–„çµ‚æºé€š", 
            questions: "å¦‚ä½•è®“å®¶å±¬æ”¾æ‰‹è€Œä¸å…§ç–šï¼Ÿ", 
            tasks: "é¸æ“‡èƒ½è½‰åŒ–ç„¦æ…®ä¸¦ä¿è­‰ã€Œ<span class='jit-term' data-def='Non-abandonment (ä¸é›¢æ£„)ï¼šæ‰¿è«¾æä¾›èˆ’é©è­·ç†èˆ‡é™ªä¼´ã€‚'>ä¸é›¢æ£„</span>ã€çš„ç­–ç•¥ã€‚", 
            messages: [
                { role: "player", text: "ï¼ˆæˆ‘å¿…é ˆè®“ä»–çŸ¥é“ï¼Œä¸æ€¥æ•‘æ˜¯ç‚ºäº†è®“çˆ¸çˆ¸èˆ’æœåœ°èµ°...ï¼‰" }
            ], 
            choices: [
                { text: "A. ã€é˜²è¡›å›æ‡‰ã€‘å…ˆç”Ÿï¼Œæˆ‘å€‘æœ‰æ³•å¾‹æ–‡ä»¶ï¼Œä½ è¦æ±‚é•æ³•ï¼Œè«‹å†·éœã€‚", next: "action_bad" }, 
                { text: "B. ã€åŒç†å›æ‡‰ã€‘æˆ‘çŸ¥é“æ‚¨å¾ˆæ„›çˆ¸çˆ¸ã€‚ä½†çˆ¸çˆ¸ç°½ DNR æ˜¯å¸Œæœ›ä¸ç—›ã€ä¸æ’ç®¡ã€‚æˆ‘å€‘æœƒé™ªè‘—ä»–ï¼Œè®“ä»–èˆ’æœé›¢é–‹ï¼Œé€™æ˜¯æœ€å¤§çš„å­é †ã€‚", next: "action_good" }
            ] 
        },
        action_bad: { 
            segment: "Segment 3: çµæœ", objectives: "åæ€", questions: "ç‚ºä½•å®¶å±¬æ›´ç”Ÿæ°£ï¼Ÿ", tasks: "æª¢è¨ï¼šç”¨æ³•å¾‹å£“äººï¼Œæœƒè®“å……æ»¿ç½ªæƒ¡æ„Ÿçš„å®¶å±¬è¦ºå¾—è¢«æŒ‡è²¬ã€‚", 
            messages: [
                { role: "npc", name: "é™³å…ˆç”Ÿ", text: "ä½ å€‘å°±æ˜¯æƒ³çœéŒ¢ï¼æˆ‘è¦å‘Šä½ å€‘è¦‹æ­»ä¸æ•‘ï¼" }, 
                { role: "system", text: "âŒ çµæœï¼šé†«ç—…å°ç«‹ï¼Œç—…äººå¯èƒ½è¢«è¿«æ’ç®¡ã€‚" }
            ], 
            choices: [{ text: "å†è©¦ä¸€æ¬¡", next: "seg3_intro" }] 
        },
        action_good: { 
            segment: "Segment 3: çµå±€", objectives: "ç¢ºèªå–„çµ‚", questions: "å®¶å±¬æ¥å—äº†å—ï¼Ÿ", tasks: "ç¢ºèªå®¶å±¬æƒ…ç·’è½‰åŒ–ã€‚", 
            messages: [
                { role: "npc", name: "é™³å…ˆç”Ÿ", text: "(æµæ·š) ...çœŸçš„ä¸æœƒç—›å—ï¼Ÿ...é‚£æˆ‘ä¸æ’äº†ã€‚" }, 
                { role: "system", text: "âœ¨ æˆåŠŸï¼šæ‚¨å®ˆè­·äº†ç—…äººçš„<span class='jit-term' data-def='Good Death (å–„çµ‚)ï¼šèº«å¿ƒå®‰é©ï¼Œä¾æ„é¡˜å°Šåš´é›¢ä¸–ã€‚'>å–„çµ‚</span>æ¬Šç›Šã€‚" }
            ], 
            choices: [{ text: "é€²å…¥åæ€èˆ‡è©•å€¼", next: "seg4_intro" }] 
        },
        
        // --- Segment 4: åæ€èˆ‡è©•å€¼ (Corrected as Summary) ---
        seg4_intro: { 
            segment: "Segment 4: åæ€èˆ‡è©•å€¼", 
            objectives: "æ¢ç´¢ç”Ÿå‘½æ„ç¾©", 
            questions: "ä»€éº¼æ˜¯å¥½çš„è­·ç†ï¼Ÿ", 
            tasks: "è«‹åæ€ï¼šåœ¨é€™å€‹æ¡ˆä¾‹ä¸­ï¼Œè­·ç†å¸«ç™¼æ®äº†ä»€éº¼åƒ¹å€¼ï¼Ÿ", 
            messages: [
                { role: "system", text: "ã€æ¡ˆä¾‹ç¸½çµã€‘<br>æ‚¨æˆåŠŸå”åŠ©å®¶å±¬è½‰åŒ–äº†å°ã€Œå­é †ã€çš„å®šç¾©ï¼Œè®“ç—…äººå¾—ä»¥å–„çµ‚ã€‚" },
                { role: "player", text: "ï¼ˆçœ‹è‘—çˆºçˆºå®‰è©³çš„é¢å®¹ï¼Œèˆ‡å¹³éœä¸‹ä¾†çš„é™³å…ˆç”Ÿ...ï¼‰" }
            ], 
            choices: [
                { text: "ğŸ”„ é‡æ–°ç·´ç¿’ï¼šæˆ‘æƒ³å†è©¦ä¸€æ¬¡æºé€šã€‚", next: "start", restart: true }, 
                { text: "âœ… å®Œæˆæ¡ˆä¾‹ï¼šæˆ‘å·²ç†è§£å–„çµ‚èˆ‡æ³•å¾‹çš„å¹³è¡¡ã€‚", next: "start", restart: true } 
            ] 
        }
    };

    function renderScene(sceneId) { 
        const scene = scenes[sceneId]; 
        if (scene.feedback) { 
            feedbackBox.style.display = 'block'; feedbackBox.style.backgroundColor = scene.next_scene ? '#27ae60' : '#e67e22'; feedbackBox.innerHTML = scene.feedback; 
            controls.innerHTML = ''; 
            const btn = document.createElement('button'); btn.className = 'btn'; btn.innerText = scene.restart ? "é‡æ–°é–‹å§‹ â†»" : (scene.repeat_scene ? "ğŸ”™ è¿”å›é‡é¸" : "ä¸‹ä¸€éšæ®µ â”"); 
            btn.onclick = () => { feedbackBox.style.display = 'none'; renderScene(scene.next_scene || scene.repeat_scene); }; 
            controls.appendChild(btn); return; 
        } 
        moodBadge.innerText = scene.segment; objText.innerHTML = scene.objectives; qText.innerHTML = scene.questions; taskText.innerHTML = scene.tasks; 
        controls.innerHTML = ''; chatBox.innerHTML = ''; 
        let delay = 0; 
        scene.messages.forEach((msg, index) => { 
            setTimeout(() => { 
                const div = document.createElement('div'); div.className = msg.role === 'system' ? 'msg msg-player' : (msg.role === 'npc' ? 'msg msg-npc' : 'msg msg-player'); 
                if(msg.role === 'system') { div.style.backgroundColor = '#fff3cd'; div.style.color = '#856404'; div.style.border = 'none'; } 
                div.innerHTML = (msg.role === 'npc' ? `<strong>${msg.name}</strong>` : '') + msg.text; 
                chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight; 
                enableJIT(); 
                if (index === scene.messages.length - 1) { 
                    scene.choices.forEach(c => { 
                        const btn = document.createElement('button'); btn.className = 'btn'; btn.innerHTML = c.text; 
                        btn.onclick = () => renderScene(c.next); controls.appendChild(btn); 
                    }); 
                    setTimeout(enableJIT, 100); 
                } 
            }, delay); delay += 800; 
        }); 
    }
    renderScene('start');
</script>
</body>
</html>