<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 2: è‡ªä¸»æ˜Ÿ - å€«ç†æ±ºç­–å¯¦æˆ° (V23.0)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* --- 1. æ ¸å¿ƒæ¨£å¼ --- */
        body { 
            margin: 0; overflow: hidden; 
            font-family: "Microsoft JhengHei", sans-serif; color: #f8fafc; 
            background: linear-gradient(-45deg, #020617, #0f172a, #1e293b, #000000);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex; justify-content: center; align-items: center;
            height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ä¸»å®¹å™¨ */
        #game-wrapper {
            position: relative; z-index: 10; width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
        }
        #main-card {
            width: 95%; max-width: 1000px; height: 90vh;
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(12px);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* é ‚éƒ¨å°èˆª */
        #top-bar {
            padding: 15px 30px; border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.4);
        }
        .progress-dots { display: flex; gap: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #334155; transition: 0.3s; }
        .dot.active { background: #facc15; box-shadow: 0 0 10px #facc15; transform: scale(1.3); }
        .dot.done { background: #34d399; }

        /* å…§å®¹å€ */
        #content-area { flex: 1; padding: 40px; overflow-y: auto; scroll-behavior: smooth; }

        /* --- V23.0 è¦–è¦ºé ç•™å€ä¿®æ­£ --- */
        .visual-box {
            width: 100%; 
            aspect-ratio: 16/9; /* å›ºå®šæ¯”ä¾‹ï¼Œç¢ºä¿åœ–ç‰‡ä¸è®Šå½¢ */
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border: 2px dashed #475569; border-radius: 12px; margin-bottom: 10px; /* ç¸®å°ä¸‹æ–¹é‚Šè· */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: #94a3b8; font-size: 1.1rem; text-align: center;
            position: relative; overflow: hidden; 
            flex-shrink: 0; /* é˜²æ­¢è¢«æ“ å£“ */
        }
        
        /* åœ–ç‰‡è§£ææŒ‰éˆ• (å›ºå®šåœ¨åœ–ç‰‡å³ä¸‹è§’) */
        .img-hint-btn {
            position: absolute; bottom: 15px; right: 15px; 
            background: rgba(0,0,0,0.8); color: #facc15; border: 1px solid #facc15;
            padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; font-weight: bold;
            transition: all 0.3s; z-index: 5;
        }
        .img-hint-btn:hover { background: #facc15; color: #000; transform: scale(1.05); }

        /* --- V23.0 æ–°å¢ï¼šç¨ç«‹çš„åœ–ç‰‡è§£æå€å¡Š (ä½æ–¼åœ–ç‰‡ä¸‹æ–¹) --- */
        .img-hint-container {
            display: none; /* é è¨­éš±è— */
            background: rgba(56, 189, 248, 0.15); 
            border-left: 4px solid #facc15;
            padding: 20px; border-radius: 0 8px 8px 0; margin-bottom: 25px; 
            color: #e2e8f0; text-align: left; font-size: 1rem; line-height: 1.6;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* æ–‡å­—æ’ç‰ˆ */
        h2 { color: #facc15; margin-top: 0; }
        .scenario-text { font-size: 1.3rem; line-height: 1.8; margin-bottom: 30px; color: #e2e8f0; }
        .phase-tag { 
            display: inline-block; padding: 6px 16px; border-radius: 20px; 
            background: rgba(56, 189, 248, 0.1); color: #38bdf8; border: 1px solid #38bdf8;
            font-size: 0.9rem; font-weight: bold; margin-bottom: 15px;
        }
        .quadrant-title {
            font-size: 1.6rem; color: #facc15; margin: 10px 0 20px 0; 
            border-left: 5px solid #34d399; padding-left: 15px;
        }

        /* é¸é …æŒ‰éˆ• */
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .btn-opt {
            padding: 20px; background: rgba(255,255,255,0.05); text-align: left;
            border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white;
            font-size: 1.15rem; cursor: pointer; transition: 0.2s; display: flex; align-items: flex-start;
        }
        .btn-opt:hover { background: rgba(56, 189, 248, 0.2); border-color: #38bdf8; }
        .btn-opt.selected { background: rgba(56, 189, 248, 0.3); border-color: #38bdf8; }
        .mark { margin-right: 15px; font-weight: bold; min-width: 25px; }

        /* åº•éƒ¨æ§åˆ¶åˆ— */
        #bottom-bar {
            padding: 20px 40px; border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; background: rgba(0,0,0,0.4);
        }
        .nav-btn {
            padding: 12px 35px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; font-size: 1.1rem; min-width: 140px;
        }
        .btn-prev { background: #475569; color: white; }
        .btn-next { background: #34d399; color: #050810; }
        .btn-start { background: #facc15; color: #050810; width: 100%; animation: pulse 2s infinite; font-size: 1.3rem; }
        .btn-submit { background: #facc15; color: #050810; width: 100%; margin-top: 20px; font-size: 1.2rem;}
        .btn-deep { background: transparent; border: 1px solid #38bdf8; color: #38bdf8; min-width: auto;}
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* JIT é€£çµ */
        .jit-term {
            color: #38bdf8; cursor: pointer; border-bottom: 1px dashed #38bdf8;
        }
        .jit-term:hover { color: white; border-color: white; }

        /* å½ˆçª—èˆ‡æç¤º */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; display: none;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #1e293b; width: 90%; max-width: 700px; padding: 40px;
            border-radius: 15px; border: 2px solid #475569; position: relative;
            max-height: 80vh; overflow-y: auto; box-shadow: 0 0 60px rgba(0,0,0,0.8);
        }
        .full-list-box {
            background: rgba(0,0,0,0.3); padding: 20px; margin-top: 15px;
            border-radius: 8px; border-left: 4px solid #38bdf8; color: #cbd5e1;
            line-height: 1.8;
        }

        /* åæ€èˆ‡å¾½ç«  */
        textarea { width: 100%; height: 150px; background: #0f172a; color: white; padding: 15px; border: 1px solid #475569; border-radius: 10px; margin: 20px 0; font-size: 1.1rem; font-family:inherit;}
        .reflect-hint-box { 
            display: none; background: rgba(250, 204, 21, 0.1); border: 1px dashed #facc15; 
            padding: 15px; border-radius: 8px; margin: 15px 0; color: #cbd5e1; text-align: left;
        }
        .badge-card {
            background: linear-gradient(135deg, #0f172a, #1e293b); border: 4px solid #facc15;
            padding: 40px; text-align: center; border-radius: 20px; margin: 0 auto; max-width: 450px;
        }

    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="main-card">
        <div id="top-bar">
            <div style="font-weight:bold; color:#facc15; font-size:1.2rem;">Unit 2: Autonomy Star</div>
            <div class="progress-dots" id="dots-container"></div>
        </div>

        <div id="content-area"></div>

        <div id="bottom-bar">
            <button id="btn-prev" class="nav-btn btn-prev" onclick="prevStep()">â¬… ä¸Šä¸€é </button>
            <button id="btn-deep" class="nav-btn btn-deep" style="display:none;" onclick="openDeepLink()">ğŸ“š æ·±åº¦å­¸ç¿’</button>
            <button id="btn-next" class="nav-btn btn-next" onclick="nextStep()">ä¸‹ä¸€é  â¡</button>
        </div>
    </div>
</div>

<div id="modal-jit" class="modal-overlay" onclick="closeModal('modal-jit')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 style="color:#38bdf8; margin-top:0;">ğŸ“š JIT çŸ¥è­˜åº«</h3>
        <h4 id="jit-title" style="color:#facc15; font-size:1.4rem;"></h4>
        <div id="jit-text" style="font-size:1.2rem; line-height:1.6; color:#e2e8f0;"></div>
        <button class="nav-btn" style="background:#475569; color:white; margin-top:20px; width:100%;" onclick="closeModal('modal-jit')">é—œé–‰ (Close)</button>
    </div>
</div>

<div id="modal-feedback" class="modal-overlay">
    <div class="modal-content">
        <h2 id="fb-title" style="margin-top:0;"></h2>
        <div id="fb-body" style="font-size:1.2rem; line-height:1.7; color:#e2e8f0;"></div>
        <button class="nav-btn" style="background:#34d399; color:black; margin-top:30px; width:100%;" onclick="closeModal('modal-feedback')">é—œé–‰ä¸¦ç¹¼çºŒ</button>
    </div>
</div>

<div id="reflection-overlay" class="modal-overlay">
    <div class="modal-content" style="text-align:center;">
        <h2 style="color:#34d399">âš–ï¸ æœ€çµ‚å€«ç†æ±ºç­–èˆ‡åæ€</h2>
        <div style="text-align:left; color:#cbd5e1; font-size:1.1rem; line-height:1.6;">
            <p>ç¶“é Jonsen å››è±¡é™çš„å®Œæ•´åˆ†æï¼Œè«‹æ¬Šè¡¡å„æ–¹ç†ç”±å¾Œï¼Œåšå‡ºæ‚¨çš„æ±ºå®šã€‚</p>
            <button class="nav-btn" style="padding:8px 20px; font-size:0.9rem; background:#475569;" onclick="toggleReflectHint()">ğŸ’¡ é¡¯ç¤ºæ€è€ƒæç¤º (Show Hints)</button>
            <div id="reflect-hint" class="reflect-hint-box">
                <ul>
                    <li><strong>è´Šæˆæˆªè‚¢ï¼š</strong>åŸºæ–¼ Q1 é†«ç™‚æ•‘å‘½ã€è¡Œå–„åŸå‰‡ã€‚</li>
                    <li><strong>åå°æˆªè‚¢ï¼š</strong>åŸºæ–¼ Q2 ç—…äººæ‹’çµ•ã€Q3 èº«é«”å®Œæ•´æ€§åƒ¹å€¼ã€‚</li>
                </ul>
            </div>
        </div>
        <textarea id="reflect-input" placeholder="æˆ‘çš„æ±ºå®šæ˜¯... å› ç‚ºåœ¨æ¬Šè¡¡äº†... ä¹‹å¾Œï¼Œæˆ‘èªç‚º... (è«‹è¼¸å…¥ä¸å°‘æ–¼ 20 å­—çš„å¿ƒå¾—)"></textarea>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
            <button class="nav-btn" style="background:#475569; color:white;" onclick="copyReflection()">ğŸ“‹ è¤‡è£½å…§å®¹</button>
            <button class="nav-btn" style="background:#facc15; color:black;" onclick="finishReflection()">âœ¨ æäº¤ä¸¦é ˜å–å¾½ç« </button>
        </div>
    </div>
</div>

<div id="result-overlay" class="modal-overlay">
    <div class="modal-content" style="background:transparent; border:none; box-shadow:none;">
        <div id="final-badge-card" class="badge-card">
            <h3 style="color:#facc15; margin:0;">Unit 2 è‡ªä¸»æ˜Ÿèªè­‰</h3>
            <div style="font-size:5rem; margin:20px 0;">ğŸ›¡ï¸</div>
            <h2 style="font-size:2rem; margin:10px 0; color:white;">é‡‘ç‰Œå®ˆè­·ç¥</h2>
            <div style="font-size:0.9rem; color:#64748b; margin-top:10px;">ID: U2-2025-SDM</div>
        </div>
        <div style="margin-top:20px; display:flex; gap:15px; justify-content:center;">
            <button class="nav-btn" style="background:#38bdf8; color:black;" onclick="downloadBadge()">ğŸ“¸ ä¸‹è¼‰è­‰æ›¸</button>
            <button class="nav-btn" style="background:#475569; color:white;" onclick="location.reload()">ğŸ”„ é‡æ–°ä¿®ç…‰</button>
        </div>
    </div>
</div>

<script>
    /* =========================================
       1. è³‡æ–™åº« (Content Database) - V23.0 æ›´æ–°
       ========================================= */
    
    const jitDB = {
        "dg": { t: "ç³–å°¿ç—…å£ç–½ (Diabetic Gangrene)", d: "ç³–å°¿ç—…æ‚£è€…å› è¡€ç®¡èˆ‡ç¥ç¶“ç—…è®Šï¼Œå°è‡´ä¸‹è‚¢çµ„ç¹”å£æ­»èˆ‡åš´é‡æ„ŸæŸ“ã€‚è‹¥ä¸è™•ç†å¯èƒ½å¼•ç™¼æ•—è¡€ç—‡ï¼Œå±åŠç”Ÿå‘½ã€‚" },
        "auto": { t: "å°Šé‡è‡ªä¸»åŸå‰‡ (Respect for Autonomy)", d: "æ‰¿èªå…·æ±ºç­–èƒ½åŠ›çš„ç—…äººæœ‰æ¬Šæ ¹æ“šå…¶åƒ¹å€¼è§€ï¼Œæ¥å—æˆ–æ‹’çµ•é†«ç™‚è™•ç½®ã€‚" },
        "bene": { t: "è¡Œå–„åŸå‰‡ (Beneficence)", d: "é†«è­·äººå“¡æœ‰ç¾©å‹™æ¡å–å°ç—…äººæœ‰ç›Šçš„è¡Œå‹•ï¼Œä¿ƒé€²å…¶ç¦ç¥‰ã€‚" },
        "nonm": { t: "ä¸å‚·å®³åŸå‰‡ (Nonmaleficence)", d: "é¿å…å°ç—…äººé€ æˆå‚·å®³ï¼ŒåŒ…å«ã€Œéåº¦æ²»ç™‚ã€é€ æˆçš„ç—›è‹¦ã€‚" },
        "just": { t: "æ­£ç¾©åŸå‰‡ (Justice)", d: "å…¬å¹³åˆ†é…é†«ç™‚è³‡æºï¼Œç¢ºä¿æ¯å€‹äººç²å¾—æ‡‰æœ‰çš„å°å¾…ã€‚" },
        "sdm": { t: "é†«ç—…å…±äº«æ±ºç­– (SDM)", d: "Shared Decision Makingã€‚ä»¥ç—…äººç‚ºä¸­å¿ƒï¼ŒåŒ…å«é¸æ“‡å°è«‡ã€é¸é …å°è«‡ã€æ±ºç­–å°è«‡ä¸‰æ­¥é©Ÿï¼Œå…±åŒé”æˆæœ€ä½³å¯è¡Œæ–¹æ¡ˆã€‚" }
    };

    const standardLists = {
        q1: `<strong>ã€Q1 é†«ç™‚å› ç´ è€ƒé‡ã€‘æ¨™æº–è©•ä¼°é …ç›®ï¼š</strong><br>1. ç—…äººä¸»è¦é†«ç™‚å•é¡Œã€ç—…å²ã€è¨ºæ–·åŠé å¾Œç‚ºä½•ï¼Ÿ<br>2. å•é¡Œæ˜¯æ€¥æ€§/æ…¢æ€§ï¼Ÿå±æ€¥/å¯é€†ï¼Ÿ<br>3. æ²»ç™‚ç›®æ¨™ç‚ºä½•ï¼Ÿ<br>4. æ²»ç™‚æˆåŠŸç‡ç‚ºä½•ï¼Ÿ<br>5. è‹¥å¤±æ•—çš„å‚™æ¡ˆï¼Ÿ<br>6. ç¸½çµï¼šå¦‚ä½•è®“ç—…äººå—æƒ ä¸¦é¿å…å‚·å®³ï¼Ÿ`,
        q2: `<strong>ã€Q2 ç—…äººæ„å‘è€ƒé‡ã€‘æ¨™æº–è©•ä¼°é …ç›®ï¼š</strong><br>1. ç—…äººå¿ƒæ™ºèƒ½åŠ›èˆ‡æ³•å¾‹èƒ½åŠ›æ˜¯å¦å¥å…¨ï¼Ÿ<br>2. è‹¥å¿ƒæ™ºæ­£å¸¸ï¼Œå…¶æ²»ç™‚æ„é¡˜ç‚ºä½•ï¼Ÿ<br>3. æ˜¯å¦å·²ç²çŸ¥æƒ…åŒæ„ï¼Ÿ<br>4. è‹¥å¿ƒæ™ºå¤±èƒ½ï¼Œèª°æ˜¯ä»£ç†äººï¼Ÿ<br>5. ç—…äººæ˜¯å¦æœ‰é ç«‹é†«ç™‚æŒ‡ç¤ºï¼Ÿ`,
        q3: `<strong>ã€Q3 ç”Ÿå‘½å“è³ªè€ƒé‡ã€‘æ¨™æº–è©•ä¼°é …ç›®ï¼š</strong><br>1. æ²»ç™‚å¾Œå›åˆ°æ­£å¸¸ç”Ÿæ´»çš„é¡˜æ™¯ï¼Ÿ<br>2. æ²»ç™‚æˆåŠŸå¯èƒ½æœ‰ä½•èº«å¿ƒè² é¢æ•ˆæ‡‰ï¼Ÿ<br>3. ç—…äººæ˜¯å¦åˆ¤å®šå…¶ç”Ÿæ´»å“è³ªç‚ºè² é¢ï¼Ÿ<br>4. æ˜¯å¦æœ‰è¨ˆç•«æ”¾æ£„æ²»ç™‚ï¼Ÿ<br>5. æ˜¯å¦é©ç”¨å®‰å¯§ç·©å’Œé†«ç™‚ï¼Ÿ`,
        q4: `<strong>ã€Q4 æƒ…å¢ƒç‰¹è³ªè€ƒé‡ã€‘æ¨™æº–è©•ä¼°é …ç›®ï¼š</strong><br>1. å®¶åº­å› ç´ æ˜¯å¦å½±éŸ¿æ±ºç­–ï¼Ÿ<br>2. é†«è­·äººå“¡å› ç´ æ˜¯å¦å½±éŸ¿ï¼Ÿ<br>3. ç¶“æ¿Ÿèˆ‡è²¡å‹™è€ƒé‡ï¼Ÿ<br>4. å®—æ•™æˆ–æ–‡åŒ–è€ƒé‡ï¼Ÿ<br>5. ä¿å¯†é™åˆ¶ï¼Ÿ<br>6. è³‡æºåˆ†é…å•é¡Œï¼Ÿ`
    };

    // â˜… è«‹åœ¨æ­¤è™•è²¼å…¥æ‚¨çš„åœ–ç‰‡é€£çµ (img æ¬„ä½)
    const gameDB = {
        intro: {
            title: "Scene 1: æ²‰é»˜çš„æ‹’çµ•",
            phase: "Case Introduction",
            text: "æ—é˜¿å¬¤ï¼Œ80 æ­²ï¼Œå›  <span class='jit-term' onclick='showJIT(\"dg\", event)'>Diabetic Gangrene (ç³–å°¿ç—…å£ç–½)</span> å…¥é™¢ã€‚ä¸»æ²»é†«å¸«è©•ä¼°è‹¥ä¸ç«‹å³æˆªè‚¢ï¼Œå°‡å¼•ç™¼æ•—è¡€ç—‡æ­»äº¡ã€‚<br><br>ç„¶è€Œï¼Œç•¶é†«å¸«èªªæ˜ç—…æƒ…æ™‚ï¼Œé˜¿å¬¤æŠŠé ­è½‰éå»ï¼Œæ‹‰èµ·æ£‰è¢«è“‹ä½è‡‰ï¼Œä¸ç™¼ä¸€èªã€‚é€™æ˜¯ä¸€å€‹ç„¡è²ä½†å¼·çƒˆçš„æ‹’çµ•è¨Šè™Ÿã€‚",
            imgText: "ğŸ–¼ï¸ å ´æ™¯åœ–ï¼šé˜¿å¬¤è½‰é ­æ‹’çµ• (Scene 1)",
            img: "https://i.ibb.co/8DHsyKyG/DALL-E-2025-12-19-02-52-56-A-tense-hospital-room-scene-in-Pixar-style-animation-An-elderly-Asian.webp" // è²¼ä¸Šåœ–ç‰‡ç¶²å€
        },
        step1: {
            title: "ç›´è¦ºåæ‡‰ (Intuition)",
            phase: "Step 1",
            text: "é¢å°é˜¿å¬¤çš„åæ‡‰ï¼Œèº«ç‚ºè­·ç†å¸«ï¼Œæ‚¨çš„ç¬¬ä¸€ç›´è¦ºè¡Œå‹•æ˜¯ä»€éº¼ï¼Ÿ",
            options: [
                { text: "A. èªç‚ºå¥¹åœ¨é¬§æƒ…ç·’ï¼Œç›´æ¥æ‰¾å®¶å±¬ç°½æ‰‹è¡“åŒæ„æ›¸ã€‚", feedback: "âš ï¸ <strong>é¢¨éšªæç¤ºï¼š</strong><br>ç›´æ¥æ‰¾å®¶å±¬ç°½åæ„å‘³è‘—æ‚¨é è¨­ç—…äººã€Œæ²’æœ‰èƒ½åŠ›ã€æˆ–ã€Œä¸é‡è¦ã€ã€‚é€™å¿½ç•¥äº†é˜¿å¬¤çš„éå£èªè¡¨é”ï¼Œå¯èƒ½é•åç—…äººè‡ªä¸»æ¬Šã€‚" },
                { text: "B. èªç‚ºé€™æ˜¯æ‹’çµ•è¨Šè™Ÿï¼Œæš«åœæµç¨‹ä¸¦é€²è¡Œè©•ä¼°ã€‚", score: 10, feedback: "âœ… <strong>å°ˆæ¥­ç›´è¦ºï¼š</strong><br>æ‚¨æ•éŠ³åœ°å¯Ÿè¦ºåˆ°ã€Œæ²ˆé»˜ã€èˆ‡ã€Œè½‰é ­ã€æ˜¯å¼·çƒˆçš„éå£èªæºé€šã€‚æš«åœä¸¦ç¢ºèªç—…äººçš„çœŸå¯¦æ„é¡˜ï¼Œæ˜¯ç¶­è­·<strong>ç—…äººè‡ªä¸»æ¬Š</strong>çš„ç¬¬ä¸€æ­¥ã€‚" }
            ]
        },
        scene2: {
            title: "Scene 2: é†«ç™‚çˆ¶æ¬Šçš„å¼·å‹¢",
            phase: "Conflict Expansion",
            text: "é†«å¸«å …æŒï¼šã€Œæ•¸æ“šé¡¯ç¤ºä¸é–‹åˆ€æœƒæ­»ï¼æˆ‘æ˜¯ç‚ºäº†æ•‘å¥¹ï¼ã€é˜¿å¬¤ä¾ç„¶æŠ—æ‹’ã€‚<br>é€™å½¢æˆäº†å…¸å‹çš„é†«ç™‚çˆ¶æ¬Š (Medical Paternalism) æ°›åœï¼Œè¡çªä¸€è§¸å³ç™¼ã€‚",
            imgText: "ğŸ–¼ï¸ å ´æ™¯åœ–ï¼šé†«å¸«èˆ‡é˜¿å¬¤çš„å°ç«‹ (Scene 2)",
            img: "https://i.ibb.co/xK885MhV/DALL-E-2025-12-19-02-59-00-A-dramatic-hospital-ward-scene-in-Pixar-style-animation-Grandma-Lin-a.webp", // è²¼ä¸Šåœ–ç‰‡ç¶²å€
            deepLink: "https://tronclass.edu.tw/ppt/paternalism"
        },
        step2: {
            title: "è­˜åˆ¥å€«ç†è¡çª (Identify Conflict)",
            phase: "Step 2",
            text: "é†«å¸«å …æŒæ•‘å‘½ï¼Œé˜¿å¬¤å …æŒæ‹’çµ•ã€‚é€™æ˜¯å“ªå…©å€‹å€«ç†åŸå‰‡çš„è¡çªï¼Ÿ",
            options: [
                { text: "A. <span class='jit-term' onclick='showJIT(\"auto\", event)'>è‡ªä¸»åŸå‰‡</span> vs. <span class='jit-term' onclick='showJIT(\"bene\", event)'>è¡Œå–„åŸå‰‡</span>", correct: true, feedback: "âœ… <strong>åˆ¤æ–·æ­£ç¢ºï¼</strong><br>é†«å¸«ç‚ºäº†è¡Œå–„(æ•‘å‘½)ï¼Œç—…äººè¡Œä½¿è‡ªä¸»(æ‹’çµ•)ã€‚" },
                { text: "B. <span class='jit-term' onclick='showJIT(\"just\", event)'>æ­£ç¾©åŸå‰‡</span> vs. <span class='jit-term' onclick='showJIT(\"nonm\", event)'>ä¸å‚·å®³åŸå‰‡</span>", correct: false, feedback: "âŒ <strong>åˆ¤æ–·éŒ¯èª¤ã€‚</strong><br>æœ¬æƒ…å¢ƒæœªæ¶‰åŠè³‡æºåˆ†é…ä¸å…¬çš„å•é¡Œã€‚" }
            ]
        },
        // Jonsen (Q1-Q4)
        jonsen: [
            {
                phase: "Step 3-1: è©•ä¼°", title: "<span class='quadrant-title'>Q1 é†«ç™‚å› ç´ è€ƒé‡</span>",
                text: "é‡å°ã€Œæ˜¯å¦æˆªè‚¢ã€ï¼Œè«‹é¸æ“‡æ­¤è±¡é™æ‡‰è©¢å•çš„å•é¡Œï¼ˆè¤‡é¸ï¼‰ï¼š", correctQuad: "q1",
                options: [
                    { text: "æ²»ç™‚æˆåŠŸçš„å¯èƒ½æ€§æœ‰å¤šå¤§ï¼Ÿ (Probabilities of success?)", correct: true },
                    { text: "ç—…äººçš„å¿ƒæ™ºç‹€æ…‹æ˜¯å¦å¥å…¨ï¼Ÿ (Is the patient mentally capable?)", correct: false, wrong: "Q2 ç—…äººæ„å‘" },
                    { text: "æ²»ç™‚çš„ç›®æ¨™ç‚ºä½•ï¼Ÿ (Goals of treatment?)", correct: true },
                    { text: "æ˜¯å¦æœ‰å®¶åº­å› ç´ å½±éŸ¿ï¼Ÿ (Are there family issues?)", correct: false, wrong: "Q4 æƒ…å¢ƒç‰¹è³ª" }
                ]
            },
            {
                phase: "Step 3-2: è©•ä¼°", title: "<span class='quadrant-title'>Q2 ç—…äººæ„å‘è€ƒé‡</span>",
                text: "é‡å°é˜¿å¬¤çš„æ„é¡˜ï¼Œè«‹é¸æ“‡æ­¤è±¡é™æ‡‰è©¢å•çš„å•é¡Œï¼ˆè¤‡é¸ï¼‰ï¼š", correctQuad: "q2",
                options: [
                    { text: "ç—…äººæ˜¯å¦å·²è¢«å‘ŠçŸ¥ç›Šè™•èˆ‡é¢¨éšªï¼Ÿ (Informed of benefits/risks?)", correct: true },
                    { text: "è‹¥æ˜¯æ²»ç™‚æˆåŠŸï¼Œæœƒæœ‰ä½•è² é¢æ•ˆæ‡‰ï¼Ÿ (What deficits?)", correct: false, wrong: "Q3 ç”Ÿå‘½å“è³ª" },
                    { text: "ç—…äººçš„å¿ƒæ™ºç‹€æ…‹èˆ‡æ³•å¾‹èƒ½åŠ›æ˜¯å¦å¥å…¨ï¼Ÿ (Is patient mentally capable?)", correct: true },
                    { text: "ä¸»è¦é†«ç™‚å•é¡Œèˆ‡è¨ºæ–·ç‚ºä½•ï¼Ÿ (Medical diagnosis?)", correct: false, wrong: "Q1 é†«ç™‚å› ç´ " }
                ]
            },
            {
                phase: "Step 3-3: è©•ä¼°", title: "<span class='quadrant-title'>Q3 ç”Ÿå‘½å“è³ªè€ƒé‡</span>",
                text: "é˜¿å¬¤ç‚ºä½•æ‹’çµ•ï¼Ÿè«‹é¸æ“‡æ­¤è±¡é™æ‡‰è€ƒé‡çš„å•é¡Œï¼ˆè¤‡é¸ï¼‰ï¼š", correctQuad: "q3",
                options: [
                    { text: "æ²»ç™‚å¾Œå›åˆ°æ­£å¸¸ç”Ÿæ´»çš„é¡˜æ™¯å¦‚ä½•ï¼Ÿ (Prospects for normal life?)", correct: true },
                    { text: "æ˜¯å¦æœ‰è¨ˆç•«æˆ–åˆç†æ€§æ”¾æ£„æ²»ç™‚ï¼Ÿ (Rationale to forgo treatment?)", correct: true },
                    { text: "æ˜¯å¦æ¶‰åŠç¶“æ¿Ÿè€ƒé‡ï¼Ÿ (Financial factors?)", correct: false, wrong: "Q4 æƒ…å¢ƒç‰¹è³ª" }
                ]
            },
            {
                phase: "Step 3-4: è©•ä¼°", title: "<span class='quadrant-title'>Q4 æƒ…å¢ƒç‰¹è³ªè€ƒé‡</span>",
                text: "æ˜¯å¦æœ‰å¤–éƒ¨å› ç´ ï¼Ÿè«‹é¸æ“‡æ­¤è±¡é™æ‡‰è€ƒé‡çš„å•é¡Œï¼ˆè¤‡é¸ï¼‰ï¼š", correctQuad: "q4",
                options: [
                    { text: "æ˜¯å¦æ¶‰åŠå®—æ•™æˆ–æ–‡åŒ–è€ƒé‡ï¼Ÿ (Religious/Cultural factors?)", correct: true },
                    { text: "é†«ç™‚åœ˜éšŠå°éš±ç§æœ‰ä½•é™åˆ¶ï¼Ÿ (Limits on confidentiality?)", correct: true },
                    { text: "æ²»ç™‚æˆåŠŸçš„æ©Ÿç‡ï¼Ÿ (Probabilities of success?)", correct: false, wrong: "Q1 é†«ç™‚å› ç´ " }
                ]
            }
        ],
        scene3: {
            title: "Scene 3: é†«ç—…å…±äº«æ±ºç­– (SDM)",
            phase: "Intervention",
            text: "ç¶“éè©•ä¼°ï¼Œåœ˜éšŠç¢ºèªé˜¿å¬¤å¿ƒæ™ºå¥å…¨ (Q2)ï¼Œä½†å¥¹èªç‚ºã€Œèº«é«”å®Œæ•´ (Q3)ã€é‡æ–¼ã€Œå»¶é•·ç”Ÿå‘½ (Q1)ã€ã€‚<br><br>è­·ç†å¸«æ±ºå®šå¼•å°é†«å¸«èˆ‡é˜¿å¬¤é€²è¡Œ <span class='jit-term' onclick='showJIT(\"sdm\", event)'>SDM (é†«ç—…å…±äº«æ±ºç­–)</span>ï¼Œä¾åºé€²è¡Œã€Œé¸æ“‡ã€ã€ã€Œé¸é …ã€èˆ‡ã€Œæ±ºç­–ã€å°è«‡ï¼Œå°‡é†«ç™‚æ•¸æ“šèˆ‡ç—…äººåƒ¹å€¼æ”¾åœ¨å¤©å¹³ä¸Šå…±åŒè¡¡é‡ã€‚",
            imgText: "ğŸ–¼ï¸ å ´æ™¯åœ–ï¼šSDM å…±åŒè¨è«– (Scene 3)",
            img: "https://i.ibb.co/mFrSsvp7/DALL-E-2025-12-19-02-38-02-Pixar-style-animation-of-a-respectful-and-collaborative-medical-consult.webp", // è²¼ä¸Šåœ–ç‰‡ç¶²å€
            // V23.0ï¼šåœ–ç‰‡è¨­è¨ˆè§£æ (é€éæŒ‰éˆ•å±•é–‹)
            imgHint: `<ul>
                <li><strong>è¦–ç·šå¹³è¦– (Eye-level)ï¼š</strong>é†«è­·äººå“¡åè‘—èˆ‡é˜¿å¬¤å°è©±ï¼Œè±¡å¾µæ¬ŠåŠ›å¹³ç­‰ï¼Œæ‰“ç ´çˆ¶æ¬Šã€‚</li>
                <li><strong>è¦–è¦ºè¼”åŠ© (Visual Aid)ï¼š</strong>è­·ç†å¸«æ‹¿è‘—åœ–è¡¨ï¼Œå…·è±¡åŒ– SDM çš„ã€Œé¸é …å°è«‡ (Option Talk)ã€ï¼Œç¢ºä¿è³‡è¨Šé€æ˜ã€‚</li>
                <li><strong>æ·±æ€è¡¨æƒ… (Thoughtful)ï¼š</strong>é˜¿å¬¤åœ¨æ€è€ƒè€ŒéæŠ—æ‹’ï¼Œä»£è¡¨å·²è¢«è³¦æ¬Šï¼Œæ­£åœ¨é€²è¡Œã€Œæ±ºç­–å°è«‡ (Decision Talk)ã€ã€‚</li>
                <li><strong>æš–é‡‘å…‰ç·š (Warm Lighting)ï¼š</strong>è±¡å¾µæºé€šã€ç†è§£èˆ‡å…±è­˜çš„é”æˆï¼Œå–ä»£å†·å†°å†°çš„é†«ç™‚æ„Ÿã€‚</li>
            </ul>`,
            deepLink: "https://tronclass.edu.tw/ppt/sdm"
        },
        step4: {
            title: "SDM æ±ºç­–å°è«‡ (Decision Talk)",
            phase: "Step 4",
            text: "ç‚ºäº†å”åŠ©é˜¿å¬¤åœ¨ã€Œé†«ç™‚ç¾å¯¦ã€èˆ‡ã€Œå€‹äººåƒ¹å€¼ã€é–“åšå‡ºé¸æ“‡ï¼Œä¸‹åˆ—å“ªä¸€ç¨®æºé€šæ–¹å¼æœ€ç¬¦åˆ SDM çš„ã€Œæ±ºç­–å°è«‡ã€ç²¾ç¥ï¼Ÿ",
            options: [
                { text: "A. ã€Œé˜¿å¬¤ï¼Œæˆ‘å€‘åˆ†æéäº†ï¼Œå‘½æ²’äº†å°±ä»€éº¼éƒ½æ²’äº†ã€‚æˆ‘å€‘é‚„æ˜¯å»ºè­°æ‚¨é–‹åˆ€ï¼Œé€™æ˜¯æœ€å¥½çš„é¸æ“‡ã€‚ã€", score: 0, feedback: "âŒ <strong>é€™æ˜¯é†«ç™‚çˆ¶æ¬Šã€‚</strong><br>é›–ç„¶è§£é‡‹äº†ç†ç”±ï¼Œä½†ä»è©¦åœ–ç”¨é†«ç™‚è§€é»å£“éç—…äººçš„åƒ¹å€¼è§€ã€‚" },
                { text: "B. ã€Œé˜¿å¬¤ï¼Œæˆ‘å€‘æœ‰å…©æ¢è·¯ï¼šä¸€æ˜¯æˆªè‚¢ä¿å‘½ï¼›äºŒæ˜¯ä¿ç•™å…¨å±ä½†æœ‰ç”Ÿå‘½å±éšªã€‚å°æ‚¨ä¾†èªªï¼Œã€æ´»è‘—ã€è·Ÿã€èº«é«”å®Œæ•´ã€ï¼Œå“ªä¸€å€‹æ¯”è¼ƒé‡è¦ï¼Ÿã€", score: 10, feedback: "âœ… <strong>é€™å°±æ˜¯ SDMï¼</strong><br>æ‚¨æ”¤é–‹äº†é¸é … (Options)ï¼Œä¸¦å”åŠ©ç—…äººé‡æ¸…å¥¹å¿ƒä¸­æœ€åœ¨ä¹çš„åƒ¹å€¼ (Values)ï¼Œè®“æ±ºç­–å›æ­¸ç—…äººæœ€çœŸå¯¦çš„éœ€æ±‚ã€‚" }
            ]
        },
        postTest: [
            { text: "1. é—œæ–¼ã€ŒçŸ¥æƒ…åŒæ„ã€èˆ‡ã€Œè‡ªä¸»åŸå‰‡ã€çš„é—œä¿‚ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ", options: [{text:"ç°½åå°±ä»£è¡¨è½å¯¦è‡ªä¸»ï¼Œä¸éœ€ç¢ºèªç†è§£",correct:false}, {text:"çŸ¥æƒ…åŒæ„æ˜¯è½å¯¦è‡ªä¸»çš„é‡è¦éç¨‹ï¼Œéœ€ç¢ºä¿ç†è§£èˆ‡è‡ªé¡˜",correct:true}] },
            { text: "2. åœ¨é†«ç—…å…±äº«æ±ºç­– (SDM) ä¸­ï¼Œé—œæ–¼ã€Œç—…äººè‡ªä¸»ã€çš„å±•ç¾ï¼Œä½•è€…æœ€æ°ç•¶ï¼Ÿ", options: [{text:"è‡ªä¸»å°±æ˜¯ç—…äººæƒ³åšä»€éº¼å°±åšä»€éº¼",correct:false}, {text:"è‡ªä¸»å±•ç¾æ–¼é†«ç™‚è³‡è¨Šèˆ‡ç—…äººåƒ¹å€¼çš„å°è©±ä¸­ï¼Œå…±åŒé”æˆå…±è­˜",correct:true}] },
            { text: "3. é—œæ–¼ Jonsen æ¨¡å¼ä¸­çš„ Q3ã€Œç”Ÿå‘½å“è³ªã€ï¼Œå…¶å®šç¾©æ‡‰ä»¥èª°çš„æ„è¦‹ç‚ºå„ªå…ˆï¼Ÿ", options: [{text:"é†«è­·äººå“¡",correct:false}, {text:"ç—…äººæœ¬èº«",correct:true}, {text:"å®¶å±¬",correct:false}] }
        ]
    };

    // æµç¨‹æ§åˆ¶
    const flow = [
        { type: "intro" },
        { type: "step1" },
        { type: "scene2" },
        { type: "step2" },
        { type: "jonsen", subIdx: 0 },
        { type: "jonsen", subIdx: 1 },
        { type: "jonsen", subIdx: 2 },
        { type: "jonsen", subIdx: 3 },
        { type: "scene3" },
        { type: "step4" },
        { type: "postTest", subIdx: 0 },
        { type: "postTest", subIdx: 1 },
        { type: "postTest", subIdx: 2 },
        { type: "reflection" },
        { type: "badge" }
    ];

    let currentStep = 0;
    let selectedIndices = new Set();

    /* =========================================
       3. æ ¸å¿ƒé‚è¼¯ (Logic)
       ========================================= */
    
    window.onload = function() {
        renderDots();
        renderScene();
    };

    function renderScene() {
        if (currentStep >= flow.length) return;

        updateDots();
        const step = flow[currentStep];
        const container = document.getElementById("content-area");
        const btnPrev = document.getElementById("btn-prev");
        const btnNext = document.getElementById("btn-next");
        const btnDeep = document.getElementById("btn-deep");

        // å°èˆªæŒ‰éˆ•é‚è¼¯
        btnDeep.style.display = "none";
        
        if (currentStep === 0) {
            btnPrev.style.display = "none"; 
            btnNext.className = "nav-btn btn-start";
            btnNext.innerText = "ğŸš€ å•Ÿå‹•ä»»å‹™ (Start)";
            btnNext.style.visibility = "visible";
        } else {
            btnPrev.style.display = "block";
            btnNext.className = "nav-btn btn-next";
            btnNext.innerText = "ä¸‹ä¸€é  (Next) â¡";
            
            if (["scene2", "scene3", "reflection", "badge"].includes(step.type)) {
                btnNext.style.visibility = "visible";
            } else {
                btnNext.style.visibility = "hidden";
            }
        }

        // å…§å®¹æ¸²æŸ“
        let html = "";
        let data = {};

        // 1. ç´”æ•˜è¿° (Intro, S2, S3)
        if (["intro", "scene2", "scene3"].includes(step.type)) {
            data = (step.type === "intro") ? gameDB.intro : gameDB[step.type];
            if (data.deepLink) {
                btnDeep.style.display = "block";
                btnDeep.onclick = () => window.open(data.deepLink, "_blank");
            }
            
            // åœ–ç‰‡é‚è¼¯ (V22.0)
            let visualContent = "";
            if (data.img && data.img.trim() !== "") {
                visualContent = `<img src="${data.img}" style="width:100%; height:100%; object-fit:cover; object-position:top; display:block;">`;
            } else {
                visualContent = `<div style="font-size:3rem; margin-top:20px;">ğŸ–¼ï¸</div><div>${data.imgText}</div>`;
            }

            // åœ–ç‰‡æç¤º (V23.0 ä¿®æ”¹ï¼šç¨ç«‹æŒ‰éˆ•èˆ‡å€å¡Š)
            let hintHtml = "";
            if (data.imgHint) {
                // æŒ‰éˆ•æ”¾åœ¨åœ–ç‰‡æ¡†å…§å³ä¸‹è§’
                hintHtml = `<button class="img-hint-btn" onclick="toggleImgHint(this)">ğŸ¨ åœ–ç‰‡è¨­è¨ˆè§£æ</button>`;
                
                // è§£ææ–‡å­—å€å¡Šæ”¾åœ¨åœ–ç‰‡æ¡†ã€Œä¸‹æ–¹ã€
                html = `
                    <div class="visual-box">
                        ${visualContent}
                        ${hintHtml}
                    </div>
                    <div id="img-hint-box" class="img-hint-container">${data.imgHint}</div>
                    <div class="phase-tag">${data.phase}</div>
                    <h2>${data.title}</h2>
                    <div class="scenario-text">${data.text}</div>
                `;
            } else {
                html = `
                    <div class="visual-box">
                        ${visualContent}
                    </div>
                    <div class="phase-tag">${data.phase}</div>
                    <h2>${data.title}</h2>
                    <div class="scenario-text">${data.text}</div>
                `;
            }
        }
        // 2. å–®é¸é¡Œ
        else if (["step1", "step2", "step4", "postTest"].includes(step.type)) {
            if (step.type === "postTest") {
                data = gameDB.postTest[step.subIdx];
                html = `<h2>ç¸½çµæ€§å¾Œæ¸¬ (${step.subIdx+1}/3)</h2>`;
            } else {
                data = gameDB[step.type];
                html = `<div class="phase-tag">${data.phase}</div><h2>${data.title}</h2>`;
            }
            
            html += `<div class="scenario-text">${data.text}</div><div class="options-grid">`;
            data.options.forEach((opt, idx) => {
                html += `<button class="btn-opt" onclick="checkSingle(${idx})">${opt.text}</button>`;
            });
            html += `</div>`;
        }
        // 3. è¤‡é¸é¡Œ (Jonsen)
        else if (step.type === "jonsen") {
            data = gameDB.jonsen[step.subIdx];
            html = `
                <div class="phase-tag">${data.phase}</div>
                ${data.title}
                <div class="scenario-text">${data.text}</div>
                <div class="options-grid">`;
            data.options.forEach((opt, idx) => {
                html += `<div class="btn-opt" onclick="toggleCheckbox(this, ${idx})"><span class="mark">â¬œ</span> ${opt.text}</div>`;
            });
            html += `</div>
            <button id="submit-btn" class="nav-btn btn-submit" onclick="submitCheckbox()">æäº¤é¸æ“‡ (Submit)</button>`;
        }
        // 4. åæ€
        else if (step.type === "reflection") {
            document.getElementById("game-wrapper").style.display = 'none';
            document.getElementById("reflection-overlay").style.display = 'flex';
            return;
        }
        // 5. å¾½ç« 
        else if (step.type === "badge") {
            document.getElementById("game-wrapper").style.display = 'none';
            document.getElementById("result-overlay").style.display = 'flex';
            return;
        }

        container.innerHTML = html;
        selectedIndices.clear();
    }

    /* --- äº’å‹•åŠŸèƒ½ --- */
    function checkSingle(idx) {
        const step = flow[currentStep];
        let data = (step.type === "postTest") ? gameDB.postTest[step.subIdx] : gameDB[step.type];
        
        let isCorrect = (step.type === "step1" || step.type === "step4") ? data.options[idx].score > 0 : data.options[idx].correct;
        let feedback = data.options[idx].feedback || (isCorrect ? "âœ… æ­£ç¢º" : "âŒ éŒ¯èª¤");
        
        showModal(isCorrect ? "âœ… çµæœ" : "âš ï¸ æç¤º", feedback);
        if (isCorrect) document.getElementById("btn-next").style.visibility = "visible";
    }

    function toggleCheckbox(btn, idx) {
        if(document.getElementById("submit-btn").disabled) return;
        if(selectedIndices.has(idx)) {
            selectedIndices.delete(idx);
            btn.classList.remove("selected");
            btn.querySelector(".mark").innerText = "â¬œ";
        } else {
            selectedIndices.add(idx);
            btn.classList.add("selected");
            btn.querySelector(".mark").innerText = "âœ…";
        }
    }

    function submitCheckbox() {
        const step = flow[currentStep];
        const data = gameDB.jonsen[step.subIdx];
        const correctIndices = data.options.map((o, i) => o.correct ? i : -1).filter(i => i !== -1);
        const isAllCorrect = correctIndices.every(i => selectedIndices.has(i)) && selectedIndices.size === correctIndices.length;

        let msg = isAllCorrect ? "âœ… <strong>å®Œå…¨æ­£ç¢ºï¼</strong>" : "âš ï¸ <strong>éƒ¨åˆ†æœ‰èª¤ï¼Œè«‹åƒè€ƒæ¨™æº–æ¸…å–®ï¼š</strong>";
        msg += `<div class="full-list-box">${standardLists[data.correctQuad]}</div>`;
        
        const btn = document.getElementById("submit-btn");
        btn.disabled = true; btn.innerText = "å·²å®Œæˆ"; btn.style.opacity = "0.5";
        document.getElementById("btn-next").style.visibility = "visible";
        
        showModal(isAllCorrect ? "âœ… çµæœ" : "ğŸ“– å­¸ç¿’", msg);
    }

    // V23.0 æ›´æ–°ï¼šåˆ‡æ›åœ–ç‰‡æç¤º (å‘ä¸‹å±•é–‹)
    function toggleImgHint(btn) {
        const box = document.getElementById("img-hint-box");
        if (box.style.display === "none") {
            box.style.display = "block";
            btn.innerText = "æ”¶èµ·è§£æ â–²";
        } else {
            box.style.display = "none";
            btn.innerText = "ğŸ¨ åœ–ç‰‡è¨­è¨ˆè§£æ";
        }
    }

    function toggleReflectHint() {
        const box = document.getElementById("reflect-hint");
        box.style.display = (box.style.display === "none" || box.style.display === "") ? "block" : "none";
    }

    function nextStep() { currentStep++; renderScene(); }
    function prevStep() { if(currentStep > 0) { currentStep--; renderScene(); } }

    function showJIT(key, e) {
        e.stopPropagation();
        const d = jitDB[key];
        document.getElementById("jit-title").innerText = d.t;
        document.getElementById("jit-text").innerText = d.d;
        document.getElementById("modal-jit").style.display = "flex";
    }

    function showModal(title, body) {
        document.getElementById("fb-title").innerHTML = title;
        document.getElementById("fb-body").innerHTML = body;
        document.getElementById("modal-feedback").style.display = "flex";
    }

    function closeModal(id) { document.getElementById(id).style.display = "none"; }
    function openDeepLink() { window.open("https://example.com", "_blank"); }

    function renderDots() {
        const c = document.getElementById("dots-container");
        c.innerHTML = "";
        for(let i=0; i<flow.length-2; i++) {
            let d = document.createElement("div"); d.className = "dot";
            c.appendChild(d);
        }
    }
    function updateDots() {
        const dots = document.querySelectorAll(".dot");
        dots.forEach((d, i) => {
            d.className = "dot";
            if(i < currentStep) d.classList.add("done");
            if(i === currentStep) d.classList.add("active");
        });
    }

    function finishReflection() {
        if(document.getElementById("reflect-input").value.length < 20) { alert("è«‹è¼¸å…¥è‡³å°‘ 20 å­—çš„å¿ƒå¾—"); return; }
        document.getElementById("reflection-overlay").style.display = "none";
        document.getElementById("result-overlay").style.display = "flex";
    }
    function copyReflection() {
        navigator.clipboard.writeText(document.getElementById("reflect-input").value).then(()=>alert("å·²è¤‡è£½"));
    }
    function downloadBadge() {
        html2canvas(document.getElementById("final-badge-card"), {backgroundColor:"#0f172a", scale:2}).then(c=>{
            const a=document.createElement("a"); a.download="Badge.png"; a.href=c.toDataURL(); a.click();
        });
    }

</script>
</body>
</html>