<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä¾‹äºŒï¼šæœ€å¾Œä¸€å¼µåºŠ (å››æ®µå®Œæ•´ç‰ˆ)</title>
    <style>
        :root { --bg-color: #1a1a1a; --left-bg: #ffffff; --right-bg: #2c3e50; --text-main: #2c3e50; --text-light: #ffffff; --highlight: #f39c12; --btn-blue: #2980b9; --nurse-bg: #d4efdf; --npc-bg: #f2f3f4; --jit-color: #d35400; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        #stage-container { width: 100vw; height: 100vh; background-color: #fff; display: flex; flex-direction: row; position: relative; }
        #story-panel { width: 60%; background-color: var(--left-bg); display: flex; flex-direction: column; padding: 20px; border-right: 5px solid #bdc3c7; position: relative; }
        #mood-badge { position: absolute; top: 20px; left: 20px; background-color: #8e44ad; color: white; padding: 10px 30px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; z-index: 5; }
        #vocab-btn { position: absolute; top: 20px; right: 20px; background-color: var(--highlight); color: #2c3e50; border: 3px solid #fff; padding: 10px 20px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; z-index: 100; transition: transform 0.2s; }
        #vocab-btn:hover { transform: scale(1.05); }
        #dialogue-box { flex: 1; overflow-y: auto; padding: 80px 20px 20px 20px; display: flex; flex-direction: column; gap: 25px; scroll-behavior: smooth; }
        .msg { max-width: 90%; padding: 25px 35px; border-radius: 20px; font-size: 2rem; line-height: 1.6; animation: fadeIn 0.5s ease; position: relative; }
        .msg-npc { align-self: flex-start; background-color: var(--npc-bg); border-left: 10px solid #c0392b; }
        .msg-player { align-self: flex-end; background-color: var(--nurse-bg); border-right: 10px solid #27ae60; }
        .msg strong { display: block; font-size: 1.6rem; margin-bottom: 10px; opacity: 0.8; }
        .jit-term { color: var(--jit-color); font-weight: bold; border-bottom: 3px dotted var(--jit-color); cursor: help; position: relative; display: inline-block; }
        #global-tooltip { position: fixed; display: none; background-color: #34495e; color: #fff; padding: 20px; border-radius: 12px; max-width: 350px; font-size: 1.4rem; line-height: 1.5; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 9999; border: 2px solid #fff; pointer-events: none; opacity: 0; transition: opacity 0.2s ease; }
        #global-tooltip strong { display: block; color: #f1c40f; font-size: 1.6rem; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }
        #analysis-panel { width: 40%; background-color: var(--right-bg); color: var(--text-light); display: flex; flex-direction: column; padding: 30px; overflow-y: auto; }
        .section-box { margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; border-left: 6px solid var(--highlight); flex-shrink: 0; }
        .section-title { font-size: 1.4rem; color: var(--highlight); font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        .section-content { font-size: 1.5rem; line-height: 1.6; color: #fff; }
        .ui-hint { text-align: center; color: rgba(255,255,255,0.7); font-size: 1rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; flex-shrink: 0; }
        #controls-area { margin-top: auto; display: flex; flex-direction: column; gap: 20px; padding-bottom: 50px; flex-shrink: 0; }
        .btn { background-color: var(--btn-blue); color: white; border: 2px solid rgba(255,255,255,0.2); padding: 25px; font-size: 1.8rem; border-radius: 15px; cursor: pointer; text-align: left; }
        .btn:hover { background-color: #2980b9; transform: translateY(-2px); }
        #feedback-box { display: none; background: #27ae60; color: white; padding: 20px; border-radius: 10px; font-size: 1.6rem; margin-top: 20px; margin-bottom: 20px; text-align: center; border: 3px solid white; flex-shrink: 0; }
        #vocab-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
        #vocab-content { background-color: #fff; width: 80%; max-width: 900px; max-height: 85vh; overflow-y: auto; border-radius: 20px; padding: 40px; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        #vocab-content h2 { color: #2c3e50; border-bottom: 3px solid var(--highlight); padding-bottom: 10px; }
        .vocab-item { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .vocab-term { font-size: 1.8rem; font-weight: bold; color: #2980b9; margin-bottom: 5px; }
        .vocab-def { font-size: 1.5rem; color: #555; line-height: 1.6; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 3rem; color: #999; cursor: pointer; line-height: 1; }
        @media (max-width: 1024px) or (orientation: portrait) {
            body { overflow-y: auto; height: auto; }
            #stage-container { flex-direction: column; height: auto; width: 100%; }
            #story-panel { width: 100%; height: 50vh; border-right: none; border-bottom: 5px solid #bdc3c7; }
            #analysis-panel { width: 100%; min-height: 50vh; padding: 20px; padding-bottom: 80px; }
            .msg { font-size: 1.3rem; padding: 15px; } .btn { font-size: 1.4rem; padding: 15px; }
            #global-tooltip { max-width: 80%; font-size: 1.2rem; bottom: 20px !important; top: auto !important; left: 50% !important; transform: translateX(-50%); }
        }
    </style>
</head>
<body>
<div id="global-tooltip"></div>
<div id="vocab-modal">
    <div id="vocab-content"><span class="close-btn" onclick="toggleVocab()">Ã—</span><h2>ğŸ“– å°ˆæ¥­è©å½™é€ŸæŸ¥</h2>
        <div class="vocab-item"><div class="vocab-term">åˆ†é…æ­£ç¾©</div><div class="vocab-def">Distributive Justiceã€‚åœ¨è³‡æºç¨€ç¼ºæ™‚ï¼Œå¦‚ä½•å…¬å¹³åˆç†åˆ†é…è³‡æºã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">é†«ç™‚æ•ˆç”¨</div><div class="vocab-def">Medical Utilityã€‚æŒ‡é†«ç™‚ä»‹å…¥èƒ½å¸¶ä¾†çš„æœ€å¤§æ•ˆç›Šï¼ˆå¦‚å­˜æ´»æ©Ÿç‡ï¼‰ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">ç¤¾æœƒåƒ¹å€¼</div><div class="vocab-def">Social Worthã€‚ä¾æ“šé“å¾·è¡Œç‚º(å¦‚é…’é§•)åˆ†é…è³‡æºï¼Œåœ¨å€«ç†ä¸­è¢«è¦–ç‚ºä¸å…¬ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">SOFA Score</div><div class="vocab-def">å™¨å®˜è¡°ç«­è©•ä¼°åˆ†æ•¸ã€‚åˆ†æ•¸è¶Šé«˜ï¼Œæ­»äº¡ç‡è¶Šé«˜ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">ä¸é›¢æ£„</div><div class="vocab-def">Non-abandonmentã€‚å³ä½¿ç„¡æ³•æä¾›æœ€ç†æƒ³çš„è³‡æºï¼Œä»æ‰¿è«¾æä¾›ç•¶ä¸‹æœ€å¥½çš„æ›¿ä»£ç…§è­·ã€‚</div></div>
    </div>
</div>
<div id="stage-container">
    <button id="vocab-btn" onclick="toggleVocab()">ğŸ“– çŸ¥è­˜é€ŸæŸ¥</button>
    <div id="story-panel"><div id="mood-badge">Segment 1</div><div id="dialogue-box"></div></div>
    <div id="analysis-panel">
        <div class="ui-hint">ğŸ’¡ æç¤ºï¼šé»æ“Š <span class="jit-term" data-def="JIT: Just-in-Time Learning">æ©˜è‰²è¢å…‰å­—</span> å¯å³æ™‚æŸ¥çœ‹å®šç¾©</div>
        <div class="section-box"><div class="section-title">ğŸ¯ Objectives</div><div class="section-content" id="obj-text"></div></div>
        <div class="section-box"><div class="section-title">â“ Question</div><div class="section-content" id="question-text"></div></div>
        <div class="section-box"><div class="section-title">ğŸ“ Task</div><div class="section-content" id="task-text"></div></div>
        <div id="feedback-box"></div><div id="controls-area"></div>
    </div>
</div>
<script>
    const chatBox = document.getElementById('dialogue-box'); const controls = document.getElementById('controls-area'); const moodBadge = document.getElementById('mood-badge'); const objText = document.getElementById('obj-text'); const qText = document.getElementById('question-text'); const taskText = document.getElementById('task-text'); const feedbackBox = document.getElementById('feedback-box'); const vocabModal = document.getElementById('vocab-modal'); const tooltip = document.getElementById('global-tooltip');
    function toggleVocab() { vocabModal.style.display = vocabModal.style.display === 'flex' ? 'none' : 'flex'; }
    function enableJIT() { const terms = document.querySelectorAll('.jit-term'); terms.forEach(term => { term.addEventListener('mouseenter', (e) => showTooltip(e, term)); term.addEventListener('mousemove', (e) => moveTooltip(e)); term.addEventListener('mouseleave', hideTooltip); term.addEventListener('click', (e) => showTooltip(e, term)); }); }
    function showTooltip(e, term) { const def = term.getAttribute('data-def'); const title = term.innerText; tooltip.innerHTML = `<strong>${title}</strong>${def}`; tooltip.style.display = 'block'; requestAnimationFrame(() => { tooltip.style.opacity = '1'; moveTooltip(e); }); }
    function moveTooltip(e) { const w = window.innerWidth; const h = window.innerHeight; let x = e.clientX + 15; let y = e.clientY + 15; if (x + 300 > w) x = e.clientX - 320; if (y + 150 > h) y = e.clientY - 160; if(w > 1024) { tooltip.style.left = x + 'px'; tooltip.style.top = y + 'px'; } }
    function hideTooltip() { tooltip.style.opacity = '0'; setTimeout(() => { tooltip.style.display = 'none'; }, 200); }

    const scenes = {
        start: { segment: "Segment 1: å€«ç†æ•æ„Ÿåº¦", objectives: "è¦ºå¯Ÿåè¦‹ (Bias Detection)", questions: "é¢å°æœ‰é™è³‡æºï¼Œæ‚¨çš„ç¬¬ä¸€ç›´è¦ºé¸æ“‡äº†èª°ï¼Ÿ", tasks: "è«‹èª å¯¦é¢å°ç›´è¦ºï¼šæ‚¨æ˜¯å¦å—åˆ°ã€Œ<span class='jit-term' data-def='ç¤¾æœƒåƒ¹å€¼ï¼šä¾æ“šå€‹äººçš„é“å¾·ç‘•ç–µ(å¦‚é…’é§•)ä¾†æ±ºå®šè³‡æºåˆ†é…ï¼Œå®¹æ˜“å°è‡´ä¸å…¬ã€‚'>ç¤¾æœƒåƒ¹å€¼</span>ã€å½±éŸ¿è€Œå¿½ç•¥äº†å®¢è§€æ•¸æ“šï¼Ÿ", messages: [{ role: "system", text: "ã€æƒ…å¢ƒã€‘ICU å‰©ä¸€åºŠã€‚å…©äººåŒæ™‚æ€¥éœ€ï¼š<br>A: 75æ­²é€€ä¼‘æ•™æˆ (å¿ƒè¡°ç«­)<br>B: 25æ­²é…’é§•è‚‡äº‹è€… (å¤šé‡å¤–å‚·)" }, { role: "npc", name: "æ€¥è¨ºé†«å¸«", text: "è­·ç†å¸«ï¼Œå‰©ä¸€å¼µåºŠè¦çµ¦èª°ï¼Ÿæ•™æˆè²¢ç»å¤§ï¼›å¹´è¼•äººå‚·é‡ä½†ä»–æ˜¯é…’é§•..." }], choices: [{ text: "A. ç›´è¦ºï¼šçµ¦æ•™æˆ (å› ç‚ºé…’é§•è€…ä¸å€¼å¾—æ•‘)ã€‚", next: "wrong_s1" }, { text: "B. ç›´è¦ºï¼šçµ¦å¹´è¼•äºº (å› ç‚ºä»–å­˜æ´»æ©Ÿç‡å¯èƒ½è¼ƒé«˜)ã€‚", next: "correct_s1" }] },
        wrong_s1: { feedback: "âš ï¸ è¦ºå¯Ÿæç¤ºï¼šæ‚¨ä½¿ç”¨äº†ã€Œç¤¾æœƒåƒ¹å€¼ã€åˆ¤æ–·ã€‚é†«ç™‚æ±ºç­–æ‡‰åŸºæ–¼ã€Œèª°èƒ½æ´»ä¸‹ä¾†ã€ï¼Œè€Œä¸æ˜¯ã€Œèª°æ˜¯å¥½äººã€ã€‚", repeat_scene: "start" },
        correct_s1: { feedback: "ğŸ‰ å¾ˆå¥½ï¼æ‚¨æš«æ™‚æ”¾ä¸‹äº†å°é…’é§•çš„æˆè¦‹ï¼Œå˜—è©¦å¾ã€Œé†«ç™‚æ•ˆç”¨ã€çš„è§’åº¦åˆ‡å…¥ã€‚", next_scene: "seg2_intro" },
        seg2_intro: { segment: "Segment 2: å€«ç†æ¨ç†", objectives: "é‹ç”¨æ­£ç¾©åŸå‰‡ (Justice)", questions: "åœ¨è³‡æºç¨€ç¼ºæ™‚ï¼Œæ‡‰æ¡ç”¨æ•ˆç›Šä¸»ç¾©é‚„æ˜¯å¹³æ¬Šä¸»ç¾©ï¼Ÿ", tasks: "è«‹ä¾æ“šã€Œ<span class='jit-term' data-def='é†«ç™‚æ•ˆç”¨ï¼šæŒ‡é†«ç™‚ä»‹å…¥èƒ½å¸¶ä¾†çš„æœ€å¤§æ•ˆç›Šï¼Œå¦‚å­˜æ´»ç‡ã€‚'>é†«ç™‚æ•ˆç”¨</span>ã€æ•¸æ“šåšå‡ºé¸æ“‡ã€‚", messages: [{ role: "system", text: "ã€æ•¸æ“šåˆ†æã€‘<br>A (æ•™æˆ): <span class='jit-term' data-def='SOFA 12åˆ†ï¼šæ­»äº¡ç‡æ¥µé«˜ã€‚'>SOFA 12åˆ†</span><br>B (é…’é§•): SOFA 8åˆ† (é å¾Œè¼ƒä½³)" }, { role: "player", text: "ï¼ˆæˆ‘çœ‹è‘—æ•¸æ“šï¼Œå¿…é ˆåšå‡ºç¬¦åˆåˆ†é…æ­£ç¾©çš„æ±ºå®š...ï¼‰" }], choices: [{ text: "A. é¸æ“‡ A (æ•™æˆ)ï¼šåŸºæ–¼æ•¬è€å°Šè³¢èˆ‡ç¤¾æœƒåœ°ä½ã€‚", next: "wrong_s2" }, { text: "B. é¸æ“‡ B (å¹´è¼•äºº)ï¼šåŸºæ–¼æœ€å¤§é†«ç™‚æ•ˆç›Šã€‚", next: "correct_s2" }] },
        wrong_s2: { feedback: "âš ï¸ æ¨ç†æç¤ºï¼šé›–ç„¶æ•¬è€æ˜¯ç¾å¾·ï¼Œä½†åœ¨ICUåºŠä½åˆ†é…ä¸­ï¼ŒA çš„æ­»äº¡ç‡éé«˜ï¼Œçµ¦äºˆåºŠä½å¯èƒ½ç„¡æ³•é”æˆã€Œæ•‘æ´»ç—…äººã€çš„ç›®æ¨™ã€‚", repeat_scene: "seg2_intro" },
        correct_s2: { feedback: "ğŸ‰ æ¨ç†æ­£ç¢ºï¼ä¾æ“šå™¨å®˜åŠŸèƒ½åˆ†æ•¸ (SOFA)ï¼ŒB çš„å­˜æ´»æ©Ÿç‡è¼ƒé«˜ã€‚é€™æ˜¯åŸºæ–¼å®¢è§€æ•¸æ“šçš„ã€Œåˆ†é…æ­£ç¾©ã€ã€‚", next_scene: "seg3_intro" },
        seg3_intro: { segment: "Segment 3: å°ˆæ¥­è¡Œå‹•", objectives: "è™•ç†é“å¾·å›°æ“¾", questions: "ç•¶æ±ºç­–æ­£ç¢ºä½†æƒ…æ„Ÿç—›è‹¦æ™‚ï¼Œå¦‚ä½•é¢å°å®¶å±¬çš„æ†¤æ€’ï¼Ÿ", tasks: "è«‹é¸æ“‡å±•ç¾ã€Œ<span class='jit-term' data-def='ä¸é›¢æ£„ï¼šå³ä½¿ç„¡æ³•æä¾›ICUåºŠä½ï¼Œä»æ‰¿è«¾æä¾›ç•¶ä¸‹æœ€å¥½çš„æ€¥è¨ºç…§è­·ã€‚'>ä¸é›¢æ£„</span>ã€ç²¾ç¥çš„æºé€šç­–ç•¥ã€‚", messages: [{ role: "system", text: "ã€æƒ…å¢ƒã€‘åœ˜éšŠæ±ºå®šæ”¶æ²» Bã€‚A çš„å®¶å±¬è¡ä¾†è­·ç†ç«™å¤§ç½µã€‚" }, { role: "npc", name: "A å®¶å±¬", text: "ä½ å€‘æä»€éº¼ï¼é‚£å€‹é…’é§•åƒåœ¾å¯ä»¥ä½ ICUï¼Œæˆ‘çˆ¸è²¢ç»ä¸€è¼©å­å»åœ¨æ€¥è¨ºç­‰æ­»ï¼Ÿ" }], choices: [{ text: "A. ã€é˜²è¡›å›æ‡‰ã€‘é€™æ˜¯ä¸»ä»»æ±ºå®šçš„ï¼Œæˆ‘ä¹Ÿæ²’è¾¦æ³•ã€‚", next: "action_bad" }, { text: "B. ã€å°ˆæ¥­å›æ‡‰ã€‘å­¸é•·ï¼Œæˆ‘ç†è§£æ‚¨çš„æ†¤æ€’ã€‚ä½†æˆ‘å€‘æœƒåœ¨æ€¥è¨ºç›¡å…¨åŠ›ç…§é¡§çˆ¸çˆ¸ã€‚", next: "action_good" }] },
        action_bad: { segment: "Segment 3: çµæœ", objectives: "åæ€", questions: "æ¨å¸è²¬ä»»èƒ½å®‰æ’«å®¶å±¬å—ï¼Ÿ", tasks: "æª¢è¨ï¼šé˜²è¡›æ€§å›æ‡‰åªæœƒè®“å®¶å±¬æ„Ÿåˆ°æ›´ç„¡åŠ©èˆ‡è¢«éºæ£„ã€‚", messages: [{ role: "npc", name: "A å®¶å±¬", text: "ä½ å€‘å¤ªå†·è¡€äº†ï¼æˆ‘çµ•ä¸åŸè«’ä½ å€‘ï¼" }, { role: "system", text: "âŒ çµæœï¼šå®¶å±¬æ„Ÿåˆ°è¢«éºæ£„ï¼Œç—›è‹¦åŠ åŠ‡ã€‚" }], choices: [{ text: "å†è©¦ä¸€æ¬¡", next: "seg3_intro" }] },
        action_good: { segment: "Segment 3: çµå±€", objectives: "ç¢ºèªå®‰å…¨", questions: "å¦‚ä½•ç·©è§£å‚·å®³ï¼Ÿ", tasks: "ç¢ºèªæ‚¨å°å®¶å±¬çš„å›æ‡‰ã€‚", messages: [{ role: "npc", name: "A å®¶å±¬", text: "......(æ¡æ‹³ç—›å“­) æˆ‘çŸ¥é“æ•¸æ“šæ˜¯å°çš„ï¼Œä½†æˆ‘çœŸçš„å¾ˆä¸ç”˜å¿ƒã€‚" }, { role: "system", text: "âœ¨ æˆåŠŸï¼šæ‚¨æ¥ä½äº†å®¶å±¬çš„æƒ…ç·’ï¼Œä¸¦å …å®ˆäº†åˆ†é…æ­£ç¾©çš„ç«‹å ´ã€‚" }], choices: [{ text: "é€²å…¥åæ€èˆ‡è©•å€¼", next: "seg4_intro" }] },
        
        // --- Segment 4: åæ€èˆ‡è©•å€¼ (ä¿®æ­£å¾Œ) ---
        seg4_intro: { 
            segment: "Segment 4: åæ€èˆ‡è©•å€¼", 
            objectives: "å­¸ç¿’é·ç§»", 
            questions: "é€™æ¬¡ç¶“é©—æ•™æœƒäº†æ‚¨ä»€éº¼ï¼Ÿ", 
            tasks: "è«‹åæ€ï¼šå¦‚ä½•åœ¨ç³»çµ±é™åˆ¶ä¸‹ï¼Œä»ä¿æŒè­·ç†çš„æº«åº¦ï¼Ÿ", 
            messages: [
                { role: "system", text: "ã€æ¡ˆä¾‹ç¸½çµã€‘<br>æ‚¨é›–ç„¶ç„¡æ³•æ”¹è®ŠåºŠä½ä¸è¶³çš„äº‹å¯¦ï¼Œä½†æ‚¨æ”¹è®Šäº†ã€Œç…§é¡§çš„æº«åº¦ã€ã€‚" },
                { role: "player", text: "ï¼ˆçœ‹è‘—æ•™æˆå®¶å±¬æ…¢æ…¢å¹³éœä¸‹ä¾†ï¼Œæˆ‘çŸ¥é“æˆ‘ç›¡åŠ›äº†...ï¼‰" }
            ], 
            choices: [
                { text: "ğŸ”„ é‡æ–°ç·´ç¿’ï¼šæˆ‘æƒ³å†è©¦ä¸€æ¬¡æºé€šã€‚", next: "start", restart: true },
                { text: "âœ… å®Œæˆæ¡ˆä¾‹ï¼šæˆ‘å·²ç†è§£è³‡æºåˆ†é…çš„æ­£ç¾©ã€‚", next: "start", restart: true } 
            ] 
        }
    };
    function renderScene(sceneId) { const scene = scenes[sceneId]; if (scene.feedback) { feedbackBox.style.display = 'block'; feedbackBox.style.backgroundColor = scene.next_scene ? '#27ae60' : '#e67e22'; feedbackBox.innerHTML = scene.feedback; controls.innerHTML = ''; const btn = document.createElement('button'); btn.className = 'btn'; btn.innerText = scene.restart ? "é‡æ–°é–‹å§‹ â†»" : (scene.repeat_scene ? "ğŸ”™ è¿”å›é‡é¸" : "ä¸‹ä¸€éšæ®µ â”"); btn.onclick = () => { feedbackBox.style.display = 'none'; renderScene(scene.next_scene || scene.repeat_scene); }; controls.appendChild(btn); return; } moodBadge.innerText = scene.segment; objText.innerHTML = scene.objectives; qText.innerHTML = scene.questions; taskText.innerHTML = scene.tasks; controls.innerHTML = ''; chatBox.innerHTML = ''; let delay = 0; scene.messages.forEach((msg, index) => { setTimeout(() => { const div = document.createElement('div'); div.className = msg.role === 'system' ? 'msg msg-player' : (msg.role === 'npc' ? 'msg msg-npc' : 'msg msg-player'); if(msg.role === 'system') { div.style.backgroundColor = '#fff3cd'; div.style.color = '#856404'; div.style.border = 'none'; } div.innerHTML = (msg.role === 'npc' ? `<strong>${msg.name}</strong>` : '') + msg.text; chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight; enableJIT(); if (index === scene.messages.length - 1) { scene.choices.forEach(c => { const btn = document.createElement('button'); btn.className = 'btn'; btn.innerHTML = c.text; btn.onclick = () => renderScene(c.next); controls.appendChild(btn); }); setTimeout(enableJIT, 100); } }, delay); delay += 800; }); }
    renderScene('start');
</script>
</body>
</html>