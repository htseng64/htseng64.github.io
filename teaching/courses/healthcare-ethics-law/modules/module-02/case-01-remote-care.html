<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä¾‹ä¸€ï¼šéºå¿˜é‚Šç·£ (å››æ®µå®Œæ•´ç‰ˆ)</title>
    <style>
        :root { --bg-color: #1a1a1a; --left-bg: #ffffff; --right-bg: #2c3e50; --text-main: #2c3e50; --text-light: #ffffff; --highlight: #f1c40f; --btn-blue: #3498db; --nurse-bg: #d4efdf; --npc-bg: #f2f3f4; --jit-color: #d35400; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        #stage-container { width: 100vw; height: 100vh; background-color: #fff; display: flex; flex-direction: row; position: relative; }
        #story-panel { width: 60%; background-color: var(--left-bg); display: flex; flex-direction: column; padding: 20px; border-right: 5px solid #bdc3c7; position: relative; }
        #mood-badge { position: absolute; top: 20px; left: 20px; background-color: #e74c3c; color: white; padding: 10px 30px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; z-index: 5; }
        #vocab-btn { position: absolute; top: 20px; right: 20px; background-color: var(--highlight); color: #2c3e50; border: 3px solid #fff; padding: 10px 20px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; z-index: 100; box-shadow: 0 4px 5px rgba(0,0,0,0.3); transition: transform 0.2s; }
        #vocab-btn:hover { transform: scale(1.05); }
        #dialogue-box { flex: 1; overflow-y: auto; padding: 80px 20px 20px 20px; display: flex; flex-direction: column; gap: 25px; scroll-behavior: smooth; }
        .msg { max-width: 90%; padding: 25px 35px; border-radius: 20px; font-size: 2rem; line-height: 1.6; animation: fadeIn 0.5s ease; }
        .msg-npc { align-self: flex-start; background-color: var(--npc-bg); border-left: 10px solid #c0392b; }
        .msg-player { align-self: flex-end; background-color: var(--nurse-bg); border-right: 10px solid #27ae60; }
        .msg strong { display: block; font-size: 1.6rem; margin-bottom: 10px; opacity: 0.8; }
        .jit-term { color: var(--jit-color); font-weight: bold; border-bottom: 3px dotted var(--jit-color); cursor: help; position: relative; display: inline-block; }
        #global-tooltip { position: fixed; display: none; background-color: #34495e; color: #fff; padding: 20px; border-radius: 12px; max-width: 350px; font-size: 1.4rem; line-height: 1.5; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 9999; border: 2px solid #fff; pointer-events: none; opacity: 0; transition: opacity 0.2s ease; }
        #global-tooltip strong { display: block; color: #f1c40f; font-size: 1.6rem; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }
        #analysis-panel { width: 40%; background-color: var(--right-bg); color: var(--text-light); display: flex; flex-direction: column; padding: 30px; overflow-y: auto; }
        .section-box { margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; border-left: 6px solid var(--highlight); flex-shrink: 0; }
        .section-title { font-size: 1.4rem; color: var(--highlight); font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        .section-content { font-size: 1.5rem; line-height: 1.6; color: #fff; }
        .ui-hint { text-align: center; color: rgba(255,255,255,0.7); font-size: 1rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; flex-shrink: 0; }
        #controls-area { margin-top: auto; display: flex; flex-direction: column; gap: 20px; padding-bottom: 50px; flex-shrink: 0; }
        .btn { background-color: var(--btn-blue); color: white; border: 2px solid rgba(255,255,255,0.2); padding: 25px; font-size: 1.8rem; border-radius: 15px; cursor: pointer; text-align: left; }
        .btn:hover { background-color: #2980b9; transform: translateY(-2px); }
        #feedback-box { display: none; background: #27ae60; color: white; padding: 20px; border-radius: 10px; font-size: 1.6rem; margin-top: 20px; margin-bottom: 20px; text-align: center; border: 3px solid white; flex-shrink: 0; }
        #vocab-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
        #vocab-content { background-color: #fff; width: 80%; max-width: 900px; max-height: 85vh; overflow-y: auto; border-radius: 20px; padding: 40px; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        #vocab-content h2 { color: #2c3e50; border-bottom: 3px solid var(--highlight); padding-bottom: 10px; }
        .vocab-item { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .vocab-term { font-size: 1.8rem; font-weight: bold; color: #2980b9; margin-bottom: 5px; }
        .vocab-def { font-size: 1.5rem; color: #555; line-height: 1.6; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 3rem; color: #999; cursor: pointer; line-height: 1; }
        @media (max-width: 1024px) or (orientation: portrait) {
            body { overflow-y: auto; height: auto; }
            #stage-container { flex-direction: column; height: auto; width: 100%; }
            #story-panel { width: 100%; height: 50vh; border-right: none; border-bottom: 5px solid #bdc3c7; }
            #analysis-panel { width: 100%; min-height: 50vh; padding: 20px; padding-bottom: 80px; }
            .msg { font-size: 1.3rem; padding: 15px; } .btn { font-size: 1.4rem; padding: 15px; }
            #global-tooltip { max-width: 80%; font-size: 1.2rem; bottom: 20px !important; top: auto !important; left: 50% !important; transform: translateX(-50%); }
        }
    </style>
</head>
<body>
<div id="global-tooltip"></div>
<div id="vocab-modal">
    <div id="vocab-content"><span class="close-btn" onclick="toggleVocab()">Ã—</span><h2>ğŸ“– å°ˆæ¥­è©å½™é€ŸæŸ¥</h2>
        <div class="vocab-item"><div class="vocab-term">BPSD</div><div class="vocab-def">Behavioral and Psychological Symptoms of Dementiaã€‚æŒ‡å¤±æ™ºç—‡æ‚£è€…å‡ºç¾çš„å¹»è¦ºã€å¦„æƒ³ã€æ”»æ“Šã€éŠèµ°ã€æŠ—æ‹’ç…§è­·ç­‰è¡Œç‚ºã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">è¡Œå–„åŸå‰‡ (Beneficence)</div><div class="vocab-def">é†«ç™‚äººå“¡æ‡‰æ¡å–å°ç—…äººæœ‰ç›Šçš„è¡Œå‹•ï¼ˆå¦‚ï¼šæ¸…æ½”èº«é«”ã€ç¶­è­·å®‰å…¨ï¼‰ã€‚ä½†è‹¥éåº¦å¼·èª¿ï¼Œå¯èƒ½è®Šæˆã€Œçˆ¶æ¬Šä¸»ç¾©ã€ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">è‡ªä¸»åŸå‰‡ (Autonomy)</div><div class="vocab-def">å°Šé‡ç—…äººè‡ªæˆ‘æ±ºå®šçš„æ¬Šåˆ©ï¼ŒåŒ…æ‹¬æ‹’çµ•é†«ç™‚ç…§è­·ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">ç´„æŸ (Restraint)</div><div class="vocab-def">ä½¿ç”¨ç‰©ç†æˆ–è—¥ç‰©æ–¹å¼é™åˆ¶ç—…äººè¡Œå‹•è‡ªç”±ï¼Œæ‡‰ç‚ºã€Œæœ€å¾Œæ‰‹æ®µ (Last Resort)ã€ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">SDM (Shared Decision Making)</div><div class="vocab-def">é†«è­·äººå“¡èˆ‡ç—…äºº/å®¶å±¬å…±åŒè¨è«–ï¼Œçµåˆå¯¦è­‰é†«å­¸èˆ‡ç—…äººåƒ¹å€¼è§€ï¼Œé”æˆæœ€ä½³æ±ºç­–ã€‚</div></div>
    </div>
</div>
<div id="stage-container">
    <button id="vocab-btn" onclick="toggleVocab()">ğŸ“– çŸ¥è­˜é€ŸæŸ¥</button>
    <div id="story-panel"><div id="mood-badge">Segment 1</div><div id="dialogue-box"></div></div>
    <div id="analysis-panel">
        <div class="ui-hint">ğŸ’¡ æç¤ºï¼šé»æ“Šå°è©±ä¸­çš„ <span style="color:var(--jit-color); border-bottom:2px dashed var(--jit-color);">æ©˜è‰²è™›ç·šè©å½™</span> å¯å³æ™‚æŸ¥çœ‹å®šç¾©</div>
        <div class="section-box"><div class="section-title">ğŸ¯ Objectives</div><div class="section-content" id="obj-text"></div></div>
        <div class="section-box"><div class="section-title">â“ Question</div><div class="section-content" id="question-text"></div></div>
        <div class="section-box"><div class="section-title">ğŸ“ Task</div><div class="section-content" id="task-text"></div></div>
        <div id="feedback-box"></div><div id="controls-area"></div>
    </div>
</div>
<script>
    const chatBox = document.getElementById('dialogue-box'); const controls = document.getElementById('controls-area'); const moodBadge = document.getElementById('mood-badge'); const objText = document.getElementById('obj-text'); const qText = document.getElementById('question-text'); const taskText = document.getElementById('task-text'); const feedbackBox = document.getElementById('feedback-box'); const vocabModal = document.getElementById('vocab-modal'); const tooltip = document.getElementById('global-tooltip');
    function toggleVocab() { vocabModal.style.display = vocabModal.style.display === 'flex' ? 'none' : 'flex'; }
    function enableJIT() { const terms = document.querySelectorAll('.jit-term'); terms.forEach(term => { term.addEventListener('mouseenter', (e) => showTooltip(e, term)); term.addEventListener('mousemove', (e) => moveTooltip(e)); term.addEventListener('mouseleave', hideTooltip); term.addEventListener('click', (e) => showTooltip(e, term)); }); }
    function showTooltip(e, term) { const def = term.getAttribute('data-def'); const title = term.innerText; tooltip.innerHTML = `<strong>${title}</strong>${def}`; tooltip.style.display = 'block'; requestAnimationFrame(() => { tooltip.style.opacity = '1'; moveTooltip(e); }); }
    function moveTooltip(e) { const w = window.innerWidth; const h = window.innerHeight; let x = e.clientX + 15; let y = e.clientY + 15; if (x + 300 > w) x = e.clientX - 320; if (y + 150 > h) y = e.clientY - 160; if(w > 1024) { tooltip.style.left = x + 'px'; tooltip.style.top = y + 'px'; } }
    function hideTooltip() { tooltip.style.opacity = '0'; setTimeout(() => { tooltip.style.display = 'none'; }, 200); }

    const scenes = {
        start: { segment: "Segment 1: å€«ç†æ•æ„Ÿåº¦", objectives: "è¾¨è­˜å€«ç†è¡çª (Sensitivity)", questions: "å®¶å±¬çš„ã€Œå¥½æ„ã€èˆ‡ç—…äººçš„ã€Œæ‹’çµ•ã€ï¼Œä»£è¡¨å“ªå…©å€‹åŸå‰‡çš„è¡çªï¼Ÿ", tasks: "è«‹åˆ†æå°è©±ï¼Œè¾¨è­˜å‡ºå®¶å±¬è¦æ±‚èˆ‡ç—…äººåæ‡‰èƒŒå¾Œçš„å€«ç†åŸå‰‡ã€‚", messages: [{ role: "system", text: "ã€æƒ…å¢ƒã€‘82æ­²å¤±æ™ºç—‡æå¥¶å¥¶å…¥é™¢ç¬¬äºŒå¤©ï¼Œå‡ºç¾ <span class='jit-term' data-def='BPSDï¼šå¤±æ™ºç—‡çš„è¡Œç‚ºç²¾ç¥ç—‡ç‹€ï¼Œå¦‚æŠ—æ‹’ç…§è­·ã€‚'>BPSD</span> ç—‡ç‹€ï¼ŒæŠ—æ‹’ç…§è­·ã€‚" }, { role: "npc", name: "æå¥¶å¥¶", text: "èµ°é–‹ï¼ä¸è¦ç¢°æˆ‘ï¼" }, { role: "npc", name: "é™³å…ˆç”Ÿ (å…’å­)", text: "è­·ç†å¸«ï¼Œæ‹œè¨—å¦³å¹«å¥¹æ´—æ¾¡ï¼Œæˆ‘æ˜¯å®¶å±¬æˆ‘è² è²¬ï¼" }], choices: [{ text: "A. <span class='jit-term' data-def='è¡Œå–„åŸå‰‡ï¼šæ¡å–å°ç—…äººæœ‰ç›Šçš„è¡Œå‹•(å¦‚æ¸…æ½”)ã€‚'>è¡Œå–„åŸå‰‡</span> vs. <span class='jit-term' data-def='è‡ªä¸»åŸå‰‡ï¼šå°Šé‡ç—…äººæ‹’çµ•çš„æ¬Šåˆ©ã€‚'>è‡ªä¸»åŸå‰‡</span>", next: "correct_s1" }, { text: "B. ä¸å‚·å®³åŸå‰‡ vs. å…¬å¹³åŸå‰‡", next: "wrong_s1" }] },
        wrong_s1: { feedback: "âš ï¸ æç¤ºï¼šé€™ä¸æ˜¯è³‡æºåˆ†é…(å…¬å¹³)å•é¡Œã€‚å®¶å±¬æƒ³åšã€Œå¥½äº‹ã€(è¡Œå–„)ï¼Œç—…äººèªªã€Œä¸è¦ã€(è‡ªä¸»)ã€‚", repeat_scene: "start" },
        correct_s1: { feedback: "ğŸ‰ æ­£ç¢ºï¼é€™æ˜¯å…¸å‹çš„ã€Œè¡Œå–„ (è¡›ç”Ÿç›Šè™•)ã€èˆ‡ã€Œè‡ªä¸» (æ‹’çµ•æ¬Š)ã€è¡çªã€‚", next_scene: "seg2_intro" },
        seg2_intro: { segment: "Segment 2: å€«ç†æ¨ç†", objectives: "é‹ç”¨ Jonsen å››è±¡é™åˆ†æ", questions: "ç´„æŸèƒ½è§£æ±ºè·Œå€’å•é¡Œï¼Œä½†å°ã€Œäººã€çš„å½±éŸ¿æ˜¯ä»€éº¼ï¼Ÿ", tasks: "è«‹é‹ç”¨å››è±¡é™æ¶æ§‹ï¼Œæ¬Šè¡¡ã€Œé†«ç™‚é©æ‡‰ç—‡ã€èˆ‡ã€Œç”Ÿå‘½å“è³ªã€ã€‚", messages: [{ role: "system", text: "ã€æ¼”è®Šã€‘ç•¶æ™šæå¥¶å¥¶èºå‹•ã€‚å…’å­è¦æ±‚ï¼šã€Œç‚ºäº†å®‰å…¨ï¼ŒæŠŠå¥¹ç¶èµ·ä¾†ï¼ã€" }, { role: "npc", name: "é™³å…ˆç”Ÿ", text: "å¦‚æœä¸ç¶ï¼Œè·Œå€’éª¨æŠ˜ä½ å€‘è³ å—ï¼Ÿå¿«ç¶ï¼" }], choices: [{ text: "A. åƒ…è€ƒé‡é†«ç™‚é©æ‡‰ç—‡ï¼š<span class='jit-term' data-def='ç´„æŸï¼šé™åˆ¶è¡Œå‹•è‡ªç”±ï¼Œæ‡‰ç‚ºæœ€å¾Œæ‰‹æ®µã€‚'>ç´„æŸ</span>é˜²è·Œï¼Œæ‡‰åŸ·è¡Œã€‚", next: "wrong_s2" }, { text: "B. è€ƒé‡ç”Ÿå‘½å“è³ªï¼šç´„æŸæå®³å°Šåš´èˆ‡å¿ƒç†å®‰é©ã€‚", next: "correct_s2" }] },
        wrong_s2: { feedback: "âš ï¸ é·¹æ¶ï¼šå€«ç†æ±ºç­–ä¸èƒ½åªçœ‹ç”Ÿç†å®‰å…¨ï¼Œå¿…é ˆè€ƒé‡ç´„æŸå¸¶ä¾†çš„å¿ƒç†å‚·å®³(ç”Ÿå‘½å“è³ª)ã€‚", repeat_scene: "seg2_intro" },
        correct_s2: { feedback: "ğŸ‰ åˆ†ææ­£ç¢ºï¼æ‚¨çœ‹åˆ°äº†ã€Œç”Ÿç†å®‰å…¨ã€ä»¥å¤–çš„ã€Œå¿ƒç†å‚·å®³ã€èˆ‡ã€Œå°Šåš´ã€å•é¡Œã€‚", next_scene: "seg3_intro" },
        seg3_intro: { segment: "Segment 3: å°ˆæ¥­è¡Œå‹•", objectives: "å±•ç¾é“å¾·å‹‡æ°£èˆ‡æºé€š", questions: "å¦‚ä½•åŒç†å®¶å±¬ææ‡¼ï¼ŒåŒæ™‚å …æŒå€«ç†åº•ç·šï¼Ÿ", tasks: "é¸æ“‡ç¬¦åˆ <span class='jit-term' data-def='SDMï¼šé†«ç—…å…±äº«æ±ºç­–ã€‚'>SDM</span> çš„æºé€šç­–ç•¥ã€‚", messages: [{ role: "player", text: "ï¼ˆæˆ‘çœ‹è‘—ç„¦æ…®çš„å®¶å±¬ï¼Œæˆ‘çŸ¥é“ç›´æ¥æ‹’çµ•æœƒå¼•ç™¼è¡çª...ï¼‰" }], choices: [{ text: "A. ã€æ¬Šå¨å›æ‡‰ã€‘é†«é™¢è¦å®šä¸èƒ½éš¨ä¾¿ç¶ï¼Œè«‹é…åˆã€‚", next: "action_bad" }, { text: "B. ã€SDM æºé€šã€‘æˆ‘äº†è§£æ‚¨çš„æ“”å¿ƒã€‚æˆ‘å€‘å…ˆè©¦è©¦é›¢åºŠè­¦å ±å™¨ï¼Ÿ", next: "action_good" }] },
        action_bad: { segment: "Segment 3: çµæœ", objectives: "åæ€", questions: "æºé€šç‚ºä½•å¤±æ•ˆï¼Ÿ", tasks: "æª¢è¨æ¬Šå¨å¼æºé€šçš„å¾Œæœã€‚", messages: [{ role: "npc", name: "é™³å…ˆç”Ÿ", text: "ä½ åœ¨è¬›ä»€éº¼è¦å®šï¼æˆ‘è¦æŠ•è¨´ä½ ï¼" }, { role: "system", text: "âŒ çµæœï¼šè¡çªå‡ç´šï¼Œé†«ç—…é—œä¿‚ç ´è£‚ã€‚" }], choices: [{ text: "å†è©¦ä¸€æ¬¡", next: "seg3_intro" }] },
        action_good: { segment: "Segment 3: çµå±€", objectives: "å®Œæˆ", questions: "é€™å°±æ˜¯å°ˆæ¥­åƒ¹å€¼ã€‚", tasks: "æ­å–œå®Œæˆæ¼”ç·´ã€‚", messages: [{ role: "npc", name: "é™³å…ˆç”Ÿ", text: "...å¦‚æœä¸ç¶ä¹Ÿèƒ½å®‰å…¨ï¼Œé‚£ç•¶ç„¶å¥½ã€‚" }, { role: "system", text: "âœ¨ æˆåŠŸï¼šæ‚¨åŒç†äº†å®¶å±¬ï¼Œä¸¦æä¾›äº†æ›¿ä»£æ–¹æ¡ˆã€‚" }], choices: [{ text: "é€²å…¥åæ€èˆ‡è©•å€¼", next: "seg4_intro" }] },
        
        // --- æ–°å¢ Segment 4: åæ€èˆ‡è©•å€¼ ---
        seg4_intro: { 
            segment: "Segment 4: åæ€èˆ‡è©•å€¼", 
            objectives: "å­¸ç¿’é·ç§» (Transfer of Learning)", 
            questions: "é€™æ¬¡ç¶“é©—æ•™æœƒäº†æ‚¨ä»€éº¼ï¼Ÿ", 
            tasks: "è«‹å›é¡§éç¨‹ï¼šæ‚¨å­¸æœƒäº†å“ªäº›è™•ç†å¤±æ™ºç—‡å€«ç†è¡çªçš„é—œéµï¼Ÿ", 
            messages: [
                { role: "system", text: "ã€æ¡ˆä¾‹ç¸½çµã€‘<br>æ‚¨æˆåŠŸåœ¨ã€Œå®¶å±¬çš„å®‰å…¨ç„¦æ…®ã€èˆ‡ã€Œç—…äººçš„å°Šåš´ã€é–“å–å¾—äº†å¹³è¡¡ã€‚" },
                { role: "player", text: "ï¼ˆçœ‹è‘—æå¥¶å¥¶å®‰ç©©ç¡å»ï¼Œæ²’æœ‰è¢«ç´„æŸï¼Œæˆ‘æ„Ÿåˆ°å¾ˆæ¬£æ…°...ï¼‰" }
            ], 
            choices: [
                { text: "ğŸ”„ é‡æ–°ç·´ç¿’ï¼šæˆ‘æƒ³å†è©¦ä¸€æ¬¡æºé€šã€‚", next: "start", restart: true },
                { text: "âœ… å®Œæˆæ¡ˆä¾‹ï¼šæˆ‘å·²æŒæ¡ç´„æŸå€«ç†çš„åŸå‰‡ã€‚", next: "start", restart: true } 
            ] 
        }
    };
    function renderScene(sceneId) { const scene = scenes[sceneId]; if (scene.feedback) { feedbackBox.style.display = 'block'; feedbackBox.style.backgroundColor = scene.next_scene ? '#27ae60' : '#e67e22'; feedbackBox.innerHTML = scene.feedback; controls.innerHTML = ''; const btn = document.createElement('button'); btn.className = 'btn'; btn.innerText = scene.restart ? "é‡æ–°é–‹å§‹ â†»" : (scene.repeat_scene ? "ğŸ”™ è¿”å›é‡é¸" : "ä¸‹ä¸€éšæ®µ â”"); btn.onclick = () => { feedbackBox.style.display = 'none'; renderScene(scene.next_scene || scene.repeat_scene); }; controls.appendChild(btn); return; } moodBadge.innerText = scene.segment; objText.innerHTML = scene.objectives; qText.innerHTML = scene.questions; taskText.innerHTML = scene.tasks; controls.innerHTML = ''; chatBox.innerHTML = ''; let delay = 0; scene.messages.forEach((msg, index) => { setTimeout(() => { const div = document.createElement('div'); div.className = msg.role === 'system' ? 'msg msg-player' : (msg.role === 'npc' ? 'msg msg-npc' : 'msg msg-player'); if(msg.role === 'system') { div.style.backgroundColor = '#fff3cd'; div.style.color = '#856404'; div.style.border = 'none'; } div.innerHTML = (msg.role === 'npc' ? `<strong>${msg.name}</strong>` : '') + msg.text; chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight; enableJIT(); if (index === scene.messages.length - 1) { scene.choices.forEach(c => { const btn = document.createElement('button'); btn.className = 'btn'; btn.innerHTML = c.text; btn.onclick = () => renderScene(c.next); controls.appendChild(btn); }); setTimeout(enableJIT, 100); } }, delay); delay += 800; }); }
    renderScene('start');
</script>
</body>
</html>