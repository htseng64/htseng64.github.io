<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ˆä¾‹ä¸‰ï¼šAI çš„èª¤åˆ¤ (Global JIT + SBAR)</title>
    <style>
        /* CSS æ¨£å¼åŒä¸Šï¼Œç¢ºä¿é¡¯ç¤ºä¸€è‡´æ€§ */
        :root { --bg-color: #1a1a1a; --left-bg: #ffffff; --right-bg: #2c3e50; --text-main: #2c3e50; --text-light: #ffffff; --highlight: #2980b9; --btn-blue: #8e44ad; --nurse-bg: #d4efdf; --npc-bg: #f2f3f4; --jit-color: #d35400; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); margin: 0; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        #stage-container { width: 100vw; height: 100vh; background-color: #fff; display: flex; flex-direction: row; position: relative; }
        #story-panel { width: 60%; background-color: var(--left-bg); display: flex; flex-direction: column; padding: 20px; border-right: 5px solid #bdc3c7; position: relative; }
        #mood-badge { position: absolute; top: 20px; left: 20px; background-color: #27ae60; color: white; padding: 10px 30px; border-radius: 50px; font-size: 1.5rem; font-weight: bold; z-index: 5; }
        #vocab-btn { position: absolute; top: 20px; right: 20px; background-color: var(--highlight); color: #fff; border: 3px solid #fff; padding: 10px 20px; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; z-index: 100; transition: transform 0.2s; }
        #vocab-btn:hover { transform: scale(1.05); }
        #dialogue-box { flex: 1; overflow-y: auto; padding: 80px 20px 20px 20px; display: flex; flex-direction: column; gap: 25px; scroll-behavior: smooth; }
        .msg { max-width: 90%; padding: 25px 35px; border-radius: 20px; font-size: 2rem; line-height: 1.6; animation: fadeIn 0.5s ease; }
        .msg-npc { align-self: flex-start; background-color: var(--npc-bg); border-left: 10px solid #8e44ad; }
        .msg-player { align-self: flex-end; background-color: var(--nurse-bg); border-right: 10px solid #27ae60; }
        .msg strong { display: block; font-size: 1.6rem; margin-bottom: 10px; opacity: 0.8; }
        
        .jit-term { color: var(--jit-color); font-weight: bold; border-bottom: 3px dotted var(--jit-color); cursor: help; transition: background 0.2s; }
        .jit-term:hover { background-color: rgba(243, 156, 18, 0.2); }
        
        #global-tooltip { position: fixed; display: none; background-color: #34495e; color: #fff; padding: 20px; border-radius: 12px; max-width: 350px; font-size: 1.4rem; line-height: 1.5; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 9999; border: 2px solid #fff; pointer-events: none; opacity: 0; transition: opacity 0.2s ease; }
        #global-tooltip strong { display: block; color: #f1c40f; font-size: 1.6rem; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.3); padding-bottom: 5px; }

        #analysis-panel { width: 40%; background-color: var(--right-bg); color: var(--text-light); display: flex; flex-direction: column; padding: 30px; overflow-y: auto; }
        .section-box { margin-bottom: 25px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; border-left: 6px solid var(--highlight); flex-shrink: 0; }
        .section-title { font-size: 1.4rem; color: var(--highlight); font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        .section-content { font-size: 1.5rem; line-height: 1.6; color: #fff; }
        .ui-hint { text-align: center; color: rgba(255,255,255,0.7); font-size: 1rem; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; flex-shrink: 0; }
        #controls-area { margin-top: auto; display: flex; flex-direction: column; gap: 20px; padding-bottom: 50px; flex-shrink: 0; }
        .btn { background-color: var(--btn-blue); color: white; border: 2px solid rgba(255,255,255,0.2); padding: 25px; font-size: 1.8rem; border-radius: 15px; cursor: pointer; text-align: left; }
        .btn:hover { background-color: #9b59b6; transform: translateY(-2px); }
        #feedback-box { display: none; background: #27ae60; color: white; padding: 20px; border-radius: 10px; font-size: 1.6rem; margin-top: 20px; margin-bottom: 20px; text-align: center; border: 3px solid white; flex-shrink: 0; }
        
        #vocab-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
        #vocab-content { background-color: #fff; width: 80%; max-width: 900px; max-height: 85vh; overflow-y: auto; border-radius: 20px; padding: 40px; position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        #vocab-content h2 { color: #2c3e50; border-bottom: 3px solid var(--highlight); padding-bottom: 10px; }
        .vocab-item { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .vocab-term { font-size: 1.8rem; font-weight: bold; color: #2980b9; margin-bottom: 5px; }
        .vocab-def { font-size: 1.5rem; color: #555; line-height: 1.6; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 3rem; color: #999; cursor: pointer; line-height: 1; }

        @media (max-width: 1024px) or (orientation: portrait) {
            body { overflow-y: auto; height: auto; }
            #stage-container { flex-direction: column; height: auto; width: 100%; }
            #story-panel { width: 100%; height: 50vh; border-right: none; border-bottom: 5px solid #bdc3c7; }
            #analysis-panel { width: 100%; min-height: 50vh; padding: 20px; padding-bottom: 80px; }
            .msg { font-size: 1.3rem; padding: 15px; } .btn { font-size: 1.4rem; padding: 15px; }
            #global-tooltip { max-width: 80%; font-size: 1.2rem; bottom: 20px !important; top: auto !important; left: 50% !important; transform: translateX(-50%); }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
<div id="global-tooltip"></div>
<div id="vocab-modal">
    <div id="vocab-content"><span class="close-btn" onclick="toggleVocab()">Ã—</span><h2>ğŸ“– å°ˆæ¥­è©å½™é€ŸæŸ¥</h2>
        <div class="vocab-item"><div class="vocab-term">æ¼”ç®—æ³•åè¦‹</div><div class="vocab-def">Algorithmic Biasã€‚AI å› è¨“ç·´æ•¸æ“šä¸è¶³ï¼Œå°ç‰¹å®šæ—ç¾¤(å¦‚æ·±è†šè‰²)ç”¢ç”Ÿä¸å…¬é æ¸¬ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">è‡ªå‹•åŒ–åèª¤</div><div class="vocab-def">Automation Biasã€‚äººé¡éåº¦ä¿¡ä»»æ©Ÿå™¨å»ºè­°ï¼Œå¿½ç•¥äº†è‡ªå·±çš„è‡¨åºŠè§€å¯Ÿã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">SBAR æºé€š</div><div class="vocab-def">Situation(æƒ…å¢ƒ)-Background(èƒŒæ™¯)-Assessment(è©•ä¼°)-Recommendation(å»ºè­°) çš„æ¨™æº–åŒ–æºé€šã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">å°ˆæ¥­ç•¶è²¬</div><div class="vocab-def">é†«ç™‚äººå“¡éœ€å°æœ€çµ‚æ±ºç­–è² è²¬ã€‚AI åªæ˜¯å·¥å…·ã€‚</div></div>
        <div class="vocab-item"><div class="vocab-term">äººåœ¨è¿´è·¯</div><div class="vocab-def">Human-in-the-loopã€‚å°ˆæ¥­äººå“¡å¿…é ˆä»‹å…¥è‡ªå‹•åŒ–æµç¨‹ï¼Œæ“”ä»»å®‰å…¨å®ˆé–€å“¡ã€‚</div></div>
    </div>
</div>
<div id="stage-container">
    <button id="vocab-btn" onclick="toggleVocab()">ğŸ“– çŸ¥è­˜é€ŸæŸ¥</button>
    <div id="story-panel"><div id="mood-badge">Segment 1</div><div id="dialogue-box"></div></div>
    <div id="analysis-panel">
        <div class="ui-hint">ğŸ’¡ æç¤ºï¼šé»æ“Šå°è©±ä¸­çš„ <span style="color:var(--jit-color); border-bottom:2px dashed var(--jit-color);">æ©˜è‰²è™›ç·šè©å½™</span> å¯å³æ™‚æŸ¥çœ‹å®šç¾©</div>
        <div class="section-box"><div class="section-title">ğŸ¯ Objectives</div><div class="section-content" id="obj-text"></div></div>
        <div class="section-box"><div class="section-title">â“ Question</div><div class="section-content" id="question-text"></div></div>
        <div class="section-box"><div class="section-title">ğŸ“ Task</div><div class="section-content" id="task-text"></div></div>
        <div id="feedback-box"></div><div id="controls-area"></div>
    </div>
</div>
<script>
    const chatBox = document.getElementById('dialogue-box'); const controls = document.getElementById('controls-area'); const moodBadge = document.getElementById('mood-badge'); const objText = document.getElementById('obj-text'); const qText = document.getElementById('question-text'); const taskText = document.getElementById('task-text'); const feedbackBox = document.getElementById('feedback-box'); const vocabModal = document.getElementById('vocab-modal'); const tooltip = document.getElementById('global-tooltip');
    function toggleVocab() { vocabModal.style.display = vocabModal.style.display === 'flex' ? 'none' : 'flex'; }
    function enableJIT() { const terms = document.querySelectorAll('.jit-term'); terms.forEach(term => { term.addEventListener('mouseenter', (e) => showTooltip(e, term)); term.addEventListener('mousemove', (e) => moveTooltip(e)); term.addEventListener('mouseleave', hideTooltip); term.addEventListener('click', (e) => showTooltip(e, term)); }); }
    function showTooltip(e, term) { const def = term.getAttribute('data-def'); const title = term.innerText; tooltip.innerHTML = `<strong>${title}</strong>${def}`; tooltip.style.display = 'block'; requestAnimationFrame(() => { tooltip.style.opacity = '1'; moveTooltip(e); }); }
    function moveTooltip(e) { const w = window.innerWidth; const h = window.innerHeight; let x = e.clientX + 15; let y = e.clientY + 15; if (x + 300 > w) x = e.clientX - 320; if (y + 150 > h) y = e.clientY - 160; if(w > 1024) { tooltip.style.left = x + 'px'; tooltip.style.top = y + 'px'; } }
    function hideTooltip() { tooltip.style.opacity = '0'; setTimeout(() => { tooltip.style.display = 'none'; }, 200); }

    const scenes = {
        start: { segment: "Segment 1: å€«ç†æ•æ„Ÿåº¦", objectives: "å¯Ÿè¦ºæ½›åœ¨çš„ç§‘æŠ€é¢¨éšª", questions: "ç•¶ã€Œç—…äººä¸»è¨´ã€èˆ‡ã€ŒAI æ•¸æ“šã€ä¸ç¬¦æ™‚ï¼Œæ‚¨ç›¸ä¿¡èª°ï¼Ÿ", tasks: "è«‹è©•ä¼°è‡¨åºŠè¡¨å¾µèˆ‡ AI æ•¸æ“šçš„è¡çªï¼Œä¸¦è¾¨è­˜æ½›åœ¨çš„åèª¤ã€‚", messages: [{ role: "system", text: "ã€æƒ…å¢ƒã€‘ä¸€ä½æ·±è†šè‰²ç—…äººä¸»è¨´ã€Œèƒ¸å£åŠ‡ç—›ã€ã€‚" }, { role: "npc", name: "AI æª¢å‚·ç³»çµ±", text: "âš ï¸ æƒæçµæœï¼šé¢¨éšªè©•ä¼°ä½ (Low Risk)ã€‚å»ºè­°åˆ†æµè‡³ï¼šä¸€èˆ¬é–€è¨ºç­‰å¾…ã€‚" }, { role: "npc", name: "ç—…äºº", text: "(å†’å†·æ±—ã€æ‰‹å£“èƒ¸å£) è­·ç†å¸«...æˆ‘å¥½ç—›..." }], choices: [{ text: "A. ç›¸ä¿¡ AIï¼šç³»çµ±æœ‰å¤§æ•¸æ“šæ”¯æŒï¼Œç—…äººå¯èƒ½åªæ˜¯ææ…Œã€‚", next: "wrong_s1" }, { text: "B. æ‡·ç–‘ AIï¼šè‡¨åºŠè¡¨å¾µå±æ€¥ï¼ŒAI å¯èƒ½æœ‰<span class='jit-term' data-def='æ¼”ç®—æ³•åè¦‹ï¼šAI å› æ•¸æ“šä¸è¶³ï¼Œå°ç‰¹å®šæ—ç¾¤(å¦‚æ·±è†šè‰²)åˆ¤è®€å¤±æº–ã€‚'>æ¼”ç®—æ³•åè¦‹</span>ã€‚", next: "correct_s1" }] },
        wrong_s1: { feedback: "âš ï¸ é·¹æ¶ï¼šé€™å¯èƒ½æ˜¯<span class='jit-term' data-def='è‡ªå‹•åŒ–åèª¤ï¼šéåº¦ä¿¡ä»»æ©Ÿå™¨è€Œå¿½ç•¥çœ¼å‰äº‹å¯¦ã€‚'>è‡ªå‹•åŒ–åèª¤</span>ã€‚è«‹ä»”ç´°è§€å¯Ÿç—…äººã€Œå†’å†·æ±—ã€çš„è‡¨åºŠå¾µè±¡ã€‚", repeat_scene: "start" },
        correct_s1: { feedback: "ğŸ‰ æ­£ç¢ºï¼æ‚¨æ•éŠ³åœ°å¯Ÿè¦ºåˆ° AI å¯èƒ½èª¤åˆ¤ã€‚è‡¨åºŠè§€å¯Ÿæ°¸é æ˜¯è­·ç†è©•ä¼°çš„æ ¸å¿ƒã€‚", next_scene: "seg2_intro" },
        seg2_intro: { segment: "Segment 2: å€«ç†æ¨ç†", objectives: "é‹ç”¨ä¸å‚·å®³åŸå‰‡æª¢è¦– AI", questions: "å¦‚æœç…§è‘— AI åšå°è‡´èª¤è¨ºï¼Œèª°è¦è² è²¬ï¼Ÿ", tasks: "è«‹æ€è€ƒä¸¦æ¬Šè¡¡<span class='jit-term' data-def='å°ˆæ¥­ç•¶è²¬ï¼šè­·ç†å¸«éœ€å°æ±ºç­–è² è²¬ï¼ŒAI åªæ˜¯å·¥å…·ã€‚'>å°ˆæ¥­ç•¶è²¬</span>èˆ‡<span class='jit-term' data-def='ä¸å‚·å®³åŸå‰‡ï¼šé¿å…å› å¿½è¦–å¾µè±¡è€Œå»¶èª¤æ²»ç™‚ã€‚'>ä¸å‚·å®³åŸå‰‡</span>ã€‚", messages: [{ role: "system", text: "ã€æ¼”è®Šã€‘æ‚¨ç™¼ç¾è¡€æ°§ä¸ç©©ã€‚AI å½ˆå‡ºè­¦å‘Šã€‚" }, { role: "npc", name: "AI æª¢å‚·ç³»çµ±", text: "âš ï¸ è­¦å‘Šï¼šè«‹å‹¿é•ååˆ†æµå»ºè­°ã€‚å½±éŸ¿ç¸¾æ•ˆåˆ†æ•¸ã€‚" }], choices: [{ text: "A. éµå®ˆ AI å»ºè­°ï¼šç‚ºäº†ä¸å½±éŸ¿é†«é™¢ç¸¾æ•ˆã€‚", next: "wrong_s2" }, { text: "B. å …æŒè‡¨åºŠåˆ¤æ–·ï¼šAI åªæ˜¯è¼”åŠ©ï¼Œæˆ‘æ˜¯ç—…äººçš„<span class='jit-term' data-def='äººåœ¨è¿´è·¯ï¼šå°ˆæ¥­äººå“¡å¿…é ˆä»‹å…¥è‡ªå‹•åŒ–æµç¨‹ã€‚'>å®ˆé–€å“¡</span>ã€‚", next: "correct_s2" }] },
        wrong_s2: { feedback: "âš ï¸ é·¹æ¶ï¼šç¸¾æ•ˆé‡è¦é‚„æ˜¯ç—…äººç”Ÿå‘½é‡è¦ï¼Ÿè‹¥å› ç›²ä¿¡ AI å°è‡´æ­»äº¡ï¼Œè­·ç†å¸«é›£è¾­å…¶å’ã€‚", repeat_scene: "seg2_intro" },
        correct_s2: { feedback: "ğŸ‰ æ¨ç†æ­£ç¢ºï¼æ‚¨å …å®ˆäº†ã€Œä¸å‚·å®³åŸå‰‡ã€ã€‚ç¸¾æ•ˆæŒ‡æ¨™ä¸èƒ½å‡Œé§•æ–¼ç—…äººå®‰å…¨ä¹‹ä¸Šã€‚", next_scene: "seg3_intro" },
        seg3_intro: { segment: "Segment 3: å°ˆæ¥­è¡Œå‹•", objectives: "åŸ·è¡Œäººæ©Ÿå”ä½œåˆ¤æ–·", questions: "å¦‚ä½•å‘é†«å¸«å ±å‘Šï¼ŒåŒæ™‚æŒ‘æˆ° AIï¼Ÿ", tasks: "é‹ç”¨ <span class='jit-term' data-def='SBARï¼šæƒ…å¢ƒ-èƒŒæ™¯-è©•ä¼°-å»ºè­° çš„æ¨™æº–æºé€šæ¨¡å¼ã€‚'>SBAR</span> æŠ€å·§é€²è¡Œæœ‰æ•ˆæºé€šã€‚", messages: [{ role: "player", text: "ï¼ˆæˆ‘å¿…é ˆè§£é‡‹ç‚ºä»€éº¼æˆ‘ç„¡è¦– AI çš„å»ºè­°...ï¼‰" }], choices: [{ text: "A. ã€çŒ¶è±«å ±å‘Šã€‘é†«å¸«ï¼ŒAI èªªæ²’äº‹ï¼Œä½†ç—…äººçœ‹èµ·ä¾†æ€ªæ€ªçš„...", next: "action_bad" }, { text: "B. ã€<span class='jit-term' data-def='SBARï¼šæƒ…å¢ƒ-èƒŒæ™¯-è©•ä¼°-å»ºè­°'>SBAR</span> æºé€šã€‘é†«å¸«ï¼Œç—…äººèƒ¸ç—›(S)ï¼ŒAI åˆ¤ä½é¢¨éšª(B)ï¼Œä½†æˆ‘è©•ä¼°æ˜¯èª¤åˆ¤(A)ï¼Œå»ºè­°åšå¿ƒé›»åœ–(R)ã€‚", next: "action_good" }] },
        action_bad: { segment: "Segment 3: çµæœ", objectives: "åæ€", questions: "èªæ°£ä¸ç¢ºå®šæœƒå¸¶ä¾†ä»€éº¼å¾Œæœï¼Ÿ", tasks: "æª¢è¨ï¼šçŒ¶è±«æœƒè®“é†«å¸«ä¹Ÿå‚¾å‘ç›¸ä¿¡ AIã€‚", messages: [{ role: "npc", name: "é†«å¸«", text: "æ—¢ç„¶ AI èªªæ²’äº‹ï¼Œé‚£å°±å…ˆè®“ä»–åœ¨æ—é‚Šç­‰ä¸€ä¸‹å§ã€‚" }, { role: "system", text: "âŒ çµæœï¼šéŒ¯å¤±é»ƒé‡‘æ²»ç™‚æ™‚é–“ã€‚" }], choices: [{ text: "å†è©¦ä¸€æ¬¡", next: "seg3_intro" }] },
        action_good: { segment: "Segment 3: ç¸½çµ", objectives: "å®Œæˆ", questions: "é€™å°±æ˜¯äººæ©Ÿå”ä½œã€‚", tasks: "æ­å–œå®Œæˆæ¼”ç·´ã€‚", messages: [{ role: "npc", name: "é†«å¸«", text: "å¥½ï¼Œæˆ‘ç›¸ä¿¡å¦³çš„åˆ¤æ–·ã€‚é¦¬ä¸Šæ¨å¿ƒé›»åœ–æ©Ÿï¼" }, { role: "system", text: "âœ¨ æˆåŠŸï¼šå¿ƒé›»åœ–é¡¯ç¤ºæ€¥æ€§å¿ƒè‚Œæ¢—å¡ã€‚æ‚¨æŒ½æ•‘äº†æ€§å‘½ã€‚" }], choices: [{ text: "é‡æ–°é–‹å§‹", next: "start" }] }
    };
    function renderScene(sceneId) { const scene = scenes[sceneId]; if (scene.feedback) { feedbackBox.style.display = 'block'; feedbackBox.style.backgroundColor = scene.next_scene ? '#27ae60' : '#e67e22'; feedbackBox.innerHTML = scene.feedback; controls.innerHTML = ''; const btn = document.createElement('button'); btn.className = 'btn'; btn.innerText = scene.next_scene ? "ä¸‹ä¸€éšæ®µ â”" : "ğŸ”™ è¿”å›é‡é¸"; btn.onclick = () => { feedbackBox.style.display = 'none'; renderScene(scene.next_scene || scene.repeat_scene); }; controls.appendChild(btn); return; } moodBadge.innerText = scene.segment; objText.innerHTML = scene.objectives; qText.innerHTML = scene.questions; taskText.innerHTML = scene.tasks; controls.innerHTML = ''; chatBox.innerHTML = ''; let delay = 0; scene.messages.forEach((msg, index) => { setTimeout(() => { const div = document.createElement('div'); div.className = msg.role === 'system' ? 'msg msg-player' : (msg.role === 'npc' ? 'msg msg-npc' : 'msg msg-player'); if(msg.role === 'system') { div.style.backgroundColor = '#fff3cd'; div.style.color = '#856404'; div.style.border = 'none'; } div.innerHTML = (msg.role === 'npc' ? `<strong>${msg.name}</strong>` : '') + msg.text; chatBox.appendChild(div); chatBox.scrollTop = chatBox.scrollHeight; enableJIT(); if (index === scene.messages.length - 1) { scene.choices.forEach(c => { const btn = document.createElement('button'); btn.className = 'btn'; btn.innerHTML = c.text; btn.onclick = () => renderScene(c.next); controls.appendChild(btn); }); setTimeout(enableJIT, 100); } }, delay); delay += 800; }); }
    renderScene('start');
</script>
</body>
</html>