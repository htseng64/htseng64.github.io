<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethics Galaxy - æ•™å¸«å„€è¡¨æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #4527a0 100%);
            color: #e8eaf6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(30, 39, 73, 0.6);
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #ffd740;
            margin-bottom: 10px;
        }

        .header p {
            color: #c5cae9;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(135deg, #5e35b1, #7e57c2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(94, 53, 177, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #00bfa5, #00e676);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #e91e63);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(30, 39, 73, 0.7);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #00bfa5;
        }

        .stat-card.warning {
            border-left-color: #ffd740;
        }

        .stat-card.danger {
            border-left-color: #f44336;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #00e676;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #c5cae9;
        }

        .section {
            background: rgba(30, 39, 73, 0.6);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8rem;
            color: #ffd740;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        thead {
            background: rgba(94, 53, 177, 0.3);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(197, 202, 233, 0.2);
        }

        th {
            color: #ffd740;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(94, 53, 177, 0.2);
        }

        .progress-bar-container {
            background: rgba(30, 39, 73, 0.6);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00e676, #00bfa5);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 0.85rem;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(0, 230, 118, 0.3);
            color: #00e676;
        }

        .badge-warning {
            background: rgba(255, 215, 64, 0.3);
            color: #ffd740;
        }

        .badge-danger {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .chart-container {
            background: rgba(30, 39, 73, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .bar-chart {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            height: 200px;
            padding: 10px 0;
        }

        .bar {
            flex: 1;
            background: linear-gradient(0deg, #5e35b1, #7e57c2);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s;
            min-height: 20px;
        }

        .bar:hover {
            transform: scaleY(1.05);
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.85rem;
            color: #c5cae9;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: bold;
            color: #ffd740;
        }

        .student-card {
            background: rgba(30, 39, 73, 0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .student-card:hover {
            transform: translateX(5px);
            background: rgba(94, 53, 177, 0.3);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #00e676;
        }

        .planet-progress {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .planet-item {
            text-align: center;
            padding: 10px;
            background: rgba(30, 39, 73, 0.6);
            border-radius: 8px;
        }

        .planet-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .planet-name {
            font-size: 0.75rem;
            color: #c5cae9;
            margin-bottom: 5px;
        }

        .planet-percent {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .export-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .export-card {
            background: rgba(30, 39, 73, 0.8);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .export-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .export-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd740;
        }

        .export-desc {
            color: #c5cae9;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a237e, #4527a0);
            border: 2px solid #5e35b1;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-close {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: #e8eaf6;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .planet-progress {
                grid-template-columns: repeat(2, 1fr);
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 10px;
            }
        }

        .import-area {
            border: 2px dashed #5e35b1;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .import-area:hover {
            border-color: #7e57c2;
            background: rgba(94, 53, 177, 0.1);
        }

        .import-area input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¨™é¡Œ -->
        <div class="header">
            <h1>ğŸ“ Ethics Galaxy æ•™å¸«å„€è¡¨æ¿</h1>
            <p>å­¸ç”Ÿé€²åº¦è¿½è¹¤èˆ‡ç­ç´šåˆ†æç³»çµ±</p>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="controls">
            <button class="btn btn-success" onclick="generateDemoData()">ğŸ“Š ç”Ÿæˆç¤ºç¯„è³‡æ–™</button>
            <button class="btn" onclick="importStudentData()">ğŸ“¥ åŒ¯å…¥å­¸ç”Ÿè³‡æ–™</button>
            <button class="btn" onclick="exportClassReport()">ğŸ“¤ åŒ¯å‡ºç­ç´šå ±å‘Š</button>
            <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="stats-grid" id="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-students">0</div>
                <div class="stat-label">å­¸ç”Ÿç¸½æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-progress">0%</div>
                <div class="stat-label">å¹³å‡å®Œæˆåº¦</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-number" id="completed-students">0</div>
                <div class="stat-label">å®Œæˆæ‰€æœ‰æ˜Ÿçƒ</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-number" id="inactive-students">0</div>
                <div class="stat-label">å°šæœªé–‹å§‹</div>
            </div>
        </div>

        <!-- ç­ç´šæ•´é«”é€²åº¦ -->
        <div class="section">
            <div class="section-title">
                ğŸ“Š ç­ç´šæ•´é«”é€²åº¦åˆ†å¸ƒ
            </div>
            <div class="chart-container">
                <div class="bar-chart" id="progress-chart"></div>
            </div>
        </div>

        <!-- æ˜Ÿçƒå®Œæˆç‡ -->
        <div class="section">
            <div class="section-title">
                ğŸŒŸ å„æ˜Ÿçƒå®Œæˆç‡
            </div>
            <div class="chart-container">
                <div class="bar-chart" id="planet-chart"></div>
            </div>
        </div>

        <!-- å­¸ç”Ÿæ¸…å–® -->
        <div class="section">
            <div class="section-title">
                ğŸ‘¥ å­¸ç”Ÿè©³ç´°é€²åº¦
            </div>
            <div id="student-list"></div>
        </div>

        <!-- åŒ¯å‡ºé¸é … -->
        <div class="section">
            <div class="section-title">
                ğŸ“¤ åŒ¯å‡ºå ±å‘Šé¸é …
            </div>
            <div class="export-section">
                <div class="export-card">
                    <div class="export-icon">ğŸ“Š</div>
                    <div class="export-title">Excel å ±è¡¨</div>
                    <div class="export-desc">åŒ…å«æ‰€æœ‰å­¸ç”Ÿçš„è©³ç´°é€²åº¦æ•¸æ“šï¼Œå¯ç”¨æ–¼é€²ä¸€æ­¥åˆ†æ</div>
                    <button class="btn" onclick="exportToExcel()">åŒ¯å‡º Excel</button>
                </div>
                <div class="export-card">
                    <div class="export-icon">ğŸ“„</div>
                    <div class="export-title">PDF å ±å‘Š</div>
                    <div class="export-desc">åŒ…å«åœ–è¡¨å’Œçµ±è¨ˆåˆ†æçš„å®Œæ•´ç­ç´šå ±å‘Š</div>
                    <button class="btn" onclick="exportToPDF()">åŒ¯å‡º PDF</button>
                </div>
                <div class="export-card">
                    <div class="export-icon">ğŸ’¾</div>
                    <div class="export-title">JSON è³‡æ–™</div>
                    <div class="export-desc">åŸå§‹è³‡æ–™æ ¼å¼ï¼Œå¯ç”¨æ–¼å‚™ä»½æˆ–åŒ¯å…¥å…¶ä»–ç³»çµ±</div>
                    <button class="btn" onclick="exportToJSON()">åŒ¯å‡º JSON</button>
                </div>
            </div>
        </div>

        <!-- åŒ¯å…¥å€åŸŸï¼ˆéš±è—çš„æ–‡ä»¶è¼¸å…¥ï¼‰ -->
        <input type="file" id="file-input" accept=".json" onchange="handleFileImport(event)" style="display: none;">
    </div>

    <!-- å­¸ç”Ÿè©³æƒ…å°è©±æ¡† -->
    <div id="student-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div id="student-detail"></div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè³‡æ–™
        let teacherData = {
            students: [],
            lastUpdate: null
        };

        const PLANETS = {
            autonomy: { name: 'è‡ªä¸»æ˜Ÿçƒ', icon: 'ğŸ”µ', color: '#3d5afe' },
            beneficence: { name: 'è¡Œå–„æ˜Ÿçƒ', icon: 'ğŸŸ¢', color: '#00e676' },
            nonmaleficence: { name: 'ä¸å‚·å®³æœˆçƒ', icon: 'ğŸŸ¡', color: '#ffd740' },
            justice: { name: 'å…¬ç¾©æ˜Ÿé›²', icon: 'ğŸŸ£', color: '#9c27b0' },
            fidelity: { name: 'å¿ èª å¤ªç©ºç«™', icon: 'ğŸ”´', color: '#f44336' }
        };

        // åˆå§‹åŒ–
        function init() {
            loadTeacherData();
            updateDashboard();
        }

        // è¼‰å…¥è³‡æ–™
        function loadTeacherData() {
            const saved = localStorage.getItem('ethicsGalaxyTeacherData');
            if (saved) {
                teacherData = JSON.parse(saved);
            }
        }

        // å„²å­˜è³‡æ–™
        function saveTeacherData() {
            teacherData.lastUpdate = new Date().toISOString();
            localStorage.setItem('ethicsGalaxyTeacherData', JSON.stringify(teacherData));
            updateDashboard();
        }

        // ç”Ÿæˆç¤ºç¯„è³‡æ–™
        function generateDemoData() {
            if (teacherData.students.length > 0 && !confirm('é€™å°‡è¦†è“‹ç¾æœ‰è³‡æ–™ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                return;
            }

            const names = [
                'ç‹å°æ˜', 'æå°è¯', 'å¼µå¤§å‰', 'é™³ç¾ç²', 'æ—å¿—å¼·',
                'é»ƒæ·‘èŠ¬', 'å³å»ºåœ‹', 'é„­é›…å©·', 'åŠ‰ä¿Šå‚‘', 'è¨±é›…ç­ ',
                'æ¥Šä½³ç©', 'è”¡æ˜å®', 'è³´æ€¡å›', 'æ´ªå‰ç¿”', 'å‘¨æ¬£æ€¡',
                'è•­é›…è', 'å‘‚å®¶è±ª', 'æ±Ÿæ·‘å¨Ÿ', 'å¾åœ‹å¼·', 'è¬ä½©å›'
            ];

            teacherData.students = names.map((name, index) => {
                const progress = generateRandomProgress();
                return {
                    id: `STU${String(index + 1).padStart(3, '0')}`,
                    name: name,
                    email: `student${index + 1}@example.com`,
                    ...progress,
                    lastActive: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
                };
            });

            saveTeacherData();
            alert('âœ… å·²ç”Ÿæˆ 20 ä½å­¸ç”Ÿçš„ç¤ºç¯„è³‡æ–™ï¼');
        }

        function generateRandomProgress() {
            const planets = Object.keys(PLANETS);
            const unlockedCount = Math.floor(Math.random() * 6); // 0-5é¡†æ˜Ÿçƒ
            const unlockedPlanets = planets.slice(0, unlockedCount);
            
            const completedModules = {};
            const earnedBadges = {};
            
            unlockedPlanets.forEach(planet => {
                const moduleCount = Math.floor(Math.random() * 6); // 0-5å€‹æ¨¡çµ„
                completedModules[planet] = Array.from({length: moduleCount}, (_, i) => i + 1);
                earnedBadges[planet] = Array.from({length: moduleCount}, (_, i) => i + 1);
            });

            return {
                unlockedPlanets,
                completedModules,
                earnedBadges
            };
        }

        // æ›´æ–°å„€è¡¨æ¿
        function updateDashboard() {
            updateStats();
            updateProgressChart();
            updatePlanetChart();
            updateStudentList();
        }

        // æ›´æ–°çµ±è¨ˆå¡ç‰‡
        function updateStats() {
            const total = teacherData.students.length;
            document.getElementById('total-students').textContent = total;

            if (total === 0) {
                document.getElementById('avg-progress').textContent = '0%';
                document.getElementById('completed-students').textContent = '0';
                document.getElementById('inactive-students').textContent = '0';
                return;
            }

            // è¨ˆç®—å¹³å‡å®Œæˆåº¦
            let totalProgress = 0;
            let completedCount = 0;
            let inactiveCount = 0;

            teacherData.students.forEach(student => {
                const progress = calculateStudentProgress(student);
                totalProgress += progress;
                
                if (progress === 100) completedCount++;
                if (progress === 0) inactiveCount++;
            });

            const avgProgress = Math.round(totalProgress / total);
            document.getElementById('avg-progress').textContent = avgProgress + '%';
            document.getElementById('completed-students').textContent = completedCount;
            document.getElementById('inactive-students').textContent = inactiveCount;
        }

        // è¨ˆç®—å­¸ç”Ÿé€²åº¦
        function calculateStudentProgress(student) {
            let completed = 0;
            Object.values(student.completedModules || {}).forEach(modules => {
                completed += modules.length;
            });
            return Math.round((completed / 25) * 100);
        }

        // æ›´æ–°é€²åº¦åˆ†å¸ƒåœ–
        function updateProgressChart() {
            const ranges = [
                { label: '0%', min: 0, max: 0, count: 0 },
                { label: '1-20%', min: 1, max: 20, count: 0 },
                { label: '21-40%', min: 21, max: 40, count: 0 },
                { label: '41-60%', min: 41, max: 60, count: 0 },
                { label: '61-80%', min: 61, max: 80, count: 0 },
                { label: '81-99%', min: 81, max: 99, count: 0 },
                { label: '100%', min: 100, max: 100, count: 0 }
            ];

            teacherData.students.forEach(student => {
                const progress = calculateStudentProgress(student);
                const range = ranges.find(r => progress >= r.min && progress <= r.max);
                if (range) range.count++;
            });

            const maxCount = Math.max(...ranges.map(r => r.count), 1);
            const chartHTML = ranges.map(range => {
                const height = (range.count / maxCount) * 100;
                return `
                    <div class="bar" style="height: ${height}%;">
                        <div class="bar-value">${range.count}</div>
                        <div class="bar-label">${range.label}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('progress-chart').innerHTML = chartHTML;
        }

        // æ›´æ–°æ˜Ÿçƒå®Œæˆç‡åœ–
        function updatePlanetChart() {
            const planetStats = {};
            Object.keys(PLANETS).forEach(planet => {
                planetStats[planet] = 0;
            });

            teacherData.students.forEach(student => {
                Object.keys(student.completedModules || {}).forEach(planet => {
                    if (student.completedModules[planet].length === 5) {
                        planetStats[planet]++;
                    }
                });
            });

            const total = teacherData.students.length || 1;
            const chartHTML = Object.keys(PLANETS).map(planetId => {
                const planet = PLANETS[planetId];
                const count = planetStats[planetId];
                const percentage = Math.round((count / total) * 100);
                
                return `
                    <div class="bar" style="height: ${percentage}%; background: linear-gradient(0deg, ${planet.color}, ${planet.color}cc);">
                        <div class="bar-value">${count}</div>
                        <div class="bar-label">${planet.icon}<br>${planet.name}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('planet-chart').innerHTML = chartHTML;
        }

        // æ›´æ–°å­¸ç”Ÿæ¸…å–®
        function updateStudentList() {
            if (teacherData.students.length === 0) {
                document.getElementById('student-list').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #c5cae9;">
                        <p style="font-size: 1.2rem; margin-bottom: 20px;">å°šç„¡å­¸ç”Ÿè³‡æ–™</p>
                        <p>è«‹é»æ“Šã€Œç”Ÿæˆç¤ºç¯„è³‡æ–™ã€æˆ–ã€ŒåŒ¯å…¥å­¸ç”Ÿè³‡æ–™ã€é–‹å§‹ä½¿ç”¨</p>
                    </div>
                `;
                return;
            }

            const studentsHTML = teacherData.students.map(student => {
                const progress = calculateStudentProgress(student);
                let badgeClass = 'badge-success';
                if (progress < 40) badgeClass = 'badge-danger';
                else if (progress < 80) badgeClass = 'badge-warning';

                const planetProgressHTML = Object.keys(PLANETS).map(planetId => {
                    const planet = PLANETS[planetId];
                    const modules = student.completedModules?.[planetId] || [];
                    const planetProgress = Math.round((modules.length / 5) * 100);
                    const isUnlocked = student.unlockedPlanets?.includes(planetId);

                    return `
                        <div class="planet-item" style="opacity: ${isUnlocked ? 1 : 0.3};">
                            <div class="planet-icon">${planet.icon}</div>
                            <div class="planet-name">${planet.name}</div>
                            <div class="planet-percent" style="color: ${planet.color};">${planetProgress}%</div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="student-card" onclick="showStudentDetail('${student.id}')">
                        <div class="student-header">
                            <div>
                                <div class="student-name">${student.name}</div>
                                <div style="color: #9fa8da; font-size: 0.9rem;">${student.id} â€¢ ${student.email}</div>
                            </div>
                            <div>
                                <span class="badge ${badgeClass}">${progress}% å®Œæˆ</span>
                            </div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${progress}%;">${progress}%</div>
                        </div>
                        <div class="planet-progress">
                            ${planetProgressHTML}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('student-list').innerHTML = studentsHTML;
        }

        // é¡¯ç¤ºå­¸ç”Ÿè©³æƒ…
        function showStudentDetail(studentId) {
            const student = teacherData.students.find(s => s.id === studentId);
            if (!student) return;

            const progress = calculateStudentProgress(student);
            const detailHTML = `
                <h2 style="color: #ffd740; margin-bottom: 20px;">${student.name} çš„å­¸ç¿’è©³æƒ…</h2>
                
                <div style="background: rgba(30, 39, 73, 0.6); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <p><strong>å­¸è™Ÿï¼š</strong>${student.id}</p>
                    <p><strong>Emailï¼š</strong>${student.email}</p>
                    <p><strong>æ•´é«”é€²åº¦ï¼š</strong>${progress}%</p>
                    <p><strong>æœ€å¾Œæ´»å‹•ï¼š</strong>${new Date(student.lastActive).toLocaleString('zh-TW')}</p>
                </div>

                <h3 style="color: #00e676; margin: 20px 0 15px;">å„æ˜Ÿçƒè©³ç´°é€²åº¦</h3>
                ${Object.keys(PLANETS).map(planetId => {
                    const planet = PLANETS[planetId];
                    const modules = student.completedModules?.[planetId] || [];
                    const isUnlocked = student.unlockedPlanets?.includes(planetId);
                    const badges = student.earnedBadges?.[planetId] || [];

                    return `
                        <div style="background: rgba(30, 39, 73, 0.6); padding: 20px; border-radius: 10px; margin-bottom: 15px; opacity: ${isUnlocked ? 1 : 0.5};">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <span style="font-size: 2rem;">${planet.icon}</span>
                                <div>
                                    <div style="font-size: 1.2rem; font-weight: bold; color: ${planet.color};">${planet.name}</div>
                                    <div style="color: #c5cae9; font-size: 0.9rem;">
                                        ${isUnlocked ? `${modules.length}/5 å€‹æ¨¡çµ„å®Œæˆ` : 'ğŸ”’ å°šæœªè§£é–'}
                                    </div>
                                </div>
                            </div>
                            ${isUnlocked ? `
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    ${[1,2,3,4,5].map(i => {
                                        const completed = modules.includes(i);
                                        return `
                                            <div style="padding: 8px 15px; background: ${completed ? 'rgba(0, 230, 118, 0.3)' : 'rgba(30, 39, 73, 0.6)'}; border-radius: 8px; color: ${completed ? '#00e676' : '#666'};">
                                                ${completed ? 'âœ“' : 'â—‹'} Module ${i}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('')}
            `;

            document.getElementById('student-detail').innerHTML = detailHTML;
            document.getElementById('student-modal').classList.add('show');
        }

        // é—œé–‰å°è©±æ¡†
        function closeModal() {
            document.getElementById('student-modal').classList.remove('show');
        }

        // åŒ¯å…¥å­¸ç”Ÿè³‡æ–™
        function importStudentData() {
            document.getElementById('file-input').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.students && Array.isArray(data.students)) {
                        if (confirm(`ç¢ºå®šè¦åŒ¯å…¥ ${data.students.length} ä½å­¸ç”Ÿçš„è³‡æ–™å—ï¼Ÿé€™å°‡è¦†è“‹ç¾æœ‰è³‡æ–™ã€‚`)) {
                            teacherData = data;
                            saveTeacherData();
                            alert('âœ… è³‡æ–™åŒ¯å…¥æˆåŠŸï¼');
                        }
                    } else {
                        alert('âŒ æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼');
                    }
                } catch (err) {
                    alert('âŒ æª”æ¡ˆè®€å–å¤±æ•—ï¼š' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // åŒ¯å‡ºåŠŸèƒ½
        function exportClassReport() {
            alert('ğŸ“Š å³å°‡ä¸‹è¼‰ç­ç´šå ±å‘Š...');
            exportToJSON();
        }

        function exportToJSON() {
            const dataStr = JSON.stringify(teacherData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            downloadFile(blob, `ethics-galaxy-ç­ç´šè³‡æ–™-${new Date().toISOString().split('T')[0]}.json`);
        }

        function exportToExcel() {
            // ç”Ÿæˆ CSV æ ¼å¼
            let csv = 'å­¸è™Ÿ,å§“å,Email,æ•´é«”é€²åº¦,è‡ªä¸»æ˜Ÿçƒ,è¡Œå–„æ˜Ÿçƒ,ä¸å‚·å®³æœˆçƒ,å…¬ç¾©æ˜Ÿé›²,å¿ èª å¤ªç©ºç«™,æœ€å¾Œæ´»å‹•æ™‚é–“\n';
            
            teacherData.students.forEach(student => {
                const progress = calculateStudentProgress(student);
                const planetProgress = Object.keys(PLANETS).map(planetId => {
                    const modules = student.completedModules?.[planetId] || [];
                    return `${modules.length}/5`;
                });

                csv += `${student.id},"${student.name}",${student.email},${progress}%,${planetProgress.join(',')},${new Date(student.lastActive).toLocaleString('zh-TW')}\n`;
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            downloadFile(blob, `ethics-galaxy-å­¸ç”Ÿé€²åº¦-${new Date().toISOString().split('T')[0]}.csv`);
        }

        function exportToPDF() {
            alert('ğŸ“„ PDF åŒ¯å‡ºåŠŸèƒ½\n\næç¤ºï¼šæ‚¨å¯ä»¥ä½¿ç”¨ç€è¦½å™¨çš„ã€Œåˆ—å°ã€åŠŸèƒ½ï¼ˆCtrl+P æˆ– Cmd+Pï¼‰ï¼Œé¸æ“‡ã€Œå¦å­˜ç‚º PDFã€ä¾†ä¿å­˜æ­¤é é¢ç‚º PDF å ±å‘Šã€‚');
            window.print();
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ¸…é™¤è³‡æ–™
        function clearData() {
            if (confirm('âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                if (confirm('âš ï¸ å†æ¬¡ç¢ºèªï¼šé€™å°‡åˆªé™¤æ‰€æœ‰å­¸ç”Ÿçš„é€²åº¦è³‡æ–™ï¼')) {
                    teacherData = { students: [], lastUpdate: null };
                    saveTeacherData();
                    alert('âœ… æ‰€æœ‰è³‡æ–™å·²æ¸…é™¤ï¼');
                }
            }
        }

        // åˆå§‹åŒ–
        window.onload = init;
        window.onclick = function(event) {
            if (event.target === document.getElementById('student-modal')) {
                closeModal();
            }
        }
    </script>
</body>
</html>
