<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 1: ä½ çš„è­·ç†å¸« RPG å±¬æ€§æª¢æ¸¬</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* (é€™è£¡çš„ CSS æ¨£å¼ç¶­æŒä¸è®Šï¼Œèˆ‡ä¸Šä¸€ç‰ˆç›¸åŒ) */
        :root { --bg-color: #0f172a; --card-bg: #1e293b; --text-main: #e2e8f0; --accent-color: #38bdf8; --highlight: #facc15; --bar-bg: #334155; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: var(--bg-color); color: var(--text-main); margin: 0; display: flex; justify-content: center; min-height: 100vh; }
        #game-container { width: 100%; max-width: 900px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; }
        h1 { color: var(--accent-color); margin: 0; font-size: 1.8rem; }
        .visual-area { width: 100%; height: 300px; background-color: #000; border-radius: 15px; margin-bottom: 20px; border: 2px solid var(--accent-color); overflow: hidden; position: relative; }
        .game-img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .question-box { background-color: var(--card-bg); padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); animation: fadeIn 0.5s; }
        .q-text { font-size: 1.4rem; line-height: 1.6; margin-bottom: 25px; font-weight: bold; }
        .btn { display: block; width: 100%; padding: 15px; margin-bottom: 15px; background: linear-gradient(90deg, #334155 0%, #1e293b 100%); border: 1px solid #475569; color: white; border-radius: 10px; font-size: 1.2rem; cursor: pointer; text-align: left; transition: all 0.2s; }
        .btn:hover { background: linear-gradient(90deg, var(--accent-color) 0%, #0284c7 100%); border-color: var(--accent-color); transform: translateX(5px); }
        #result-section { display: none; animation: popIn 0.6s; }
        #download-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 3px solid var(--highlight); border-radius: 20px; padding: 30px; display: flex; flex-wrap: wrap; gap: 30px; align-items: flex-start; box-shadow: 0 0 30px rgba(250, 204, 21, 0.2); margin-bottom: 20px; position: relative; overflow: hidden; }
        #download-card::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.1) 0%, transparent 20%); pointer-events: none; }
        .card-visual-box { flex: 1; min-width: 260px; max-width: 320px; aspect-ratio: 9/16; background-color: #000; border-radius: 15px; border: 4px solid #cbd5e1; margin: 0 auto; box-shadow: 0 10px 25px rgba(0,0,0,0.6); overflow: hidden; }
        .result-img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .card-info { flex: 2; min-width: 280px; text-align: left; z-index: 2; }
        .role-title { font-size: 2.4rem; color: var(--highlight); margin: 0; font-weight: 900; letter-spacing: 1px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .role-eng { font-size: 1.1rem; color: var(--accent-color); font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .spirit-box { background: rgba(255, 255, 255, 0.05); border-left: 4px solid var(--highlight); padding: 15px; margin-bottom: 20px; border-radius: 0 10px 10px 0; }
        .spirit-item { margin-bottom: 8px; font-size: 1.1rem; line-height: 1.4; }
        .spirit-label { color: #94a3b8; font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 2px; }
        .spirit-content { color: #f1f5f9; }
        .stats-container { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 10px; margin-top: 10px; }
        .stat-row { margin-bottom: 12px; }
        .stat-label { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 1rem; color: #cbd5e1; }
        .progress-bg { width: 100%; height: 10px; background-color: var(--bar-bg); border-radius: 5px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 5px; transition: width 1s ease-out; }
        .action-btns { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .action-btn { flex: 1; min-width: 200px; padding: 15px; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; color: #0f172a; }
        .btn-download { background-color: var(--highlight); box-shadow: 0 4px 15px rgba(250, 204, 21, 0.4); }
        .btn-download:hover { background-color: #fde047; transform: translateY(-2px); }
        .btn-reflect { background-color: var(--accent-color); }
        #reflection-area { display: none; margin-top: 30px; background: #1e293b; padding: 20px; border-radius: 15px; border: 1px dashed #475569; }
        textarea { width: 100%; height: 150px; background: #0f172a; color: white; border: 1px solid #475569; padding: 15px; border-radius: 10px; font-size: 1.1rem; resize: none; box-sizing: border-box; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @media (max-width: 768px) {
            #download-card { flex-direction: column; text-align: center; }
            .card-info { text-align: left; width: 100%; }
            .spirit-box { text-align: left; }
            .role-title { text-align: center; }
            .role-eng { text-align: center; display: block; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <header><h1>âš”ï¸ å¾·è¡Œè«– RPGï¼šä½ çš„éš±è—å±¬æ€§</h1></header>
    <div id="quiz-area">
        <div class="visual-area">
            <img id="scene-img" class="game-img" src="" alt="æƒ…å¢ƒåœ–" crossorigin="anonymous">
        </div>
        <div class="question-box"><div id="question-text" class="q-text">è¼‰å…¥ä¸­...</div><div id="choices-area"></div></div>
    </div>
    <div id="result-section">
        <div id="download-card">
            <div class="card-visual-box">
                <img id="final-card-img" class="result-img" src="" alt="çµæœå¡ç‰Œ" crossorigin="anonymous">
            </div>
            <div class="card-info">
                <div class="role-title" id="final-title">???</div>
                <div class="role-eng" id="final-eng">???</div>
                <div class="spirit-box">
                    <div class="spirit-item"><span class="spirit-label">âœ¨ å®ˆè­·éˆ (Guardian Spirit)</span><span class="spirit-content" id="spirit-name">???</span></div>
                    <div class="spirit-item"><span class="spirit-label">ğŸ’¡ è±¡å¾µæ„ç¾© (Symbolism)</span><span class="spirit-content" id="spirit-meaning">???</span></div>
                </div>
                <div class="stats-container">
                    <div class="stat-row"><div class="stat-label"><span>ğŸ§  å¯¦è¸æ™ºæ…§ (Wisdom)</span><span id="score-wis">0</span></div><div class="progress-bg"><div class="progress-fill" id="bar-wis" style="width: 0%; background: #38bdf8;"></div></div></div>
                    <div class="stat-row"><div class="stat-label"><span>ğŸ›¡ï¸ é“å¾·å‹‡æ°£ (Courage)</span><span id="score-cou">0</span></div><div class="progress-bg"><div class="progress-fill" id="bar-cou" style="width: 0%; background: #ef4444;"></div></div></div>
                    <div class="stat-row"><div class="stat-label"><span>â¤ï¸ ä»æ…ˆé—œæ‡· (Compassion)</span><span id="score-com">0</span></div><div class="progress-bg"><div class="progress-fill" id="bar-com" style="width: 0%; background: #22c55e;"></div></div></div>
                    <div class="stat-row"><div class="stat-label"><span>âš–ï¸ æ­£ç›´èª ä¿¡ (Integrity)</span><span id="score-int">0</span></div><div class="progress-bg"><div class="progress-fill" id="bar-int" style="width: 0%; background: #facc15;"></div></div></div>
                </div>
            </div>
        </div>
        <div class="action-btns">
            <button class="action-btn btn-download" onclick="downloadResult()">ğŸ“¸ ä¸‹è¼‰æˆ‘çš„å±¬æ€§å¡</button>
            <button class="action-btn btn-reflect" onclick="showReflection()">ğŸ“ é€²å…¥åæ€ (Level Up)</button>
        </div>
    </div>
    <div id="reflection-area">
        <h3 style="color:var(--highlight)">ğŸ“ èª²å¾Œä»»å‹™ï¼šè£å‚™ä½ çš„å±¬æ€§</h3>
        <p>è«‹æ ¹æ“šå±¬æ€§åœ–ï¼Œå®Œæˆåæ€ä¸¦è¤‡è£½åˆ° TronClassï¼š</p>
        <textarea id="reflect-input" placeholder="1. çœ‹åˆ°é€™å€‹çµæœï¼Œä½ è¦ºå¾—æº–ç¢ºå—ï¼Ÿç‚ºä»€éº¼ï¼Ÿ&#10;2. å“ªä¸€å€‹å±¬æ€§æ˜¯ä½ ç›®å‰æœ€ç¼ºä¹çš„ï¼Ÿ&#10;3. åœ¨æœªä¾†çš„è‡¨åºŠå¯¦ç¿’ä¸­ï¼Œä½ æ‰“ç®—å¦‚ä½•ã€Œä¿®ç…‰ã€é€™å€‹å±¬æ€§ï¼Ÿ"></textarea>
        <button class="btn" style="margin-top:15px; background:var(--highlight); color:#0f172a; font-weight:bold;" onclick="copyToClipboard()">ğŸ“‹ è¤‡è£½æ–‡å­—</button>
    </div>
</div>

<script>
    // ==========================================
    // â–¼ è«‹åœ¨ä¸‹æ–¹è²¼ä¸Šæ‚¨ç”Ÿæˆçš„åœ–ç‰‡ç¶²å€ (Direct Link) â–¼
    // ==========================================
    
    // 1. æƒ…å¢ƒæ©«åœ– (å»ºè­° 16:9)
    const sceneImgs = [
        "https://i.ibb.co/KxVSswQR/DALL-E-2025-12-10-22-42-23-Scene-1-Medication-Error-A-3-D-rendered-Pixar-style-close-up-of-a-nur.webp", // æƒ…å¢ƒä¸€ï¼šçµ¦éŒ¯è—¥
        "https://i.ibb.co/ntXv9Gz/DALL-E-2025-12-10-22-50-32-Scene-2-Homeless-Patient-A-3-D-rendered-Pixar-style-isometric-hospita.webp", // æƒ…å¢ƒäºŒï¼šè¡—å‹
        "https://i.ibb.co/s99YSzyH/DALL-E-2025-12-10-22-42-52-Scene-3-Angry-Doctor-A-3-D-rendered-Pixar-style-isometric-hospital-co.webp", // æƒ…å¢ƒä¸‰ï¼šæš´èºé†«å¸«
        "https://i.ibb.co/zTW4FChq/DALL-E-2025-12-10-22-50-59-Scene-4-Busy-Nurse-A-3-D-rendered-Pixar-style-isometric-hospital-room.webp"  // æƒ…å¢ƒå››ï¼šå¿™ç¢Œ
    ];

    // 2. çµæœç›´å¼å¡ç‰Œ (å»ºè­° 9:16)
    const resultData = {
        wis: {
            title: "ç¿æ™ºçš„å°èˆªè€…",
            eng: "The Wise Navigator",
            spirit: "è²“é ­é·¹ èˆ‡ æ˜Ÿç›¤ (Owl & Astrolabe)",
            meaning: "è²“é ­é·¹ä»£è¡¨æ´å¯ŸçœŸç›¸çš„æ™ºæ…§ï¼›æ˜Ÿç›¤ä»£è¡¨åœ¨è¿·éœ§ä¸­å°èˆªçš„èƒ½åŠ›ã€‚",
            // â–¼ è²¼ä¸Šæ‚¨çš„ã€æ™ºæ…§è²“é ­é·¹ã€‘å¡ç‰Œç¶²å€
            imgUrl: "https://i.ibb.co/HcHfJfT/DALL-E-2025-12-11-00-13-06-A-vertical-trading-card-design-in-Pixar-style-titled-The-Wise-Navigat.webp" 
        },
        cou: {
            title: "ç„¡ç•çš„å®ˆè­·è€…",
            eng: "The Fearless Guardian",
            spirit: "ç…é·² èˆ‡ å…‰ç›¾ (Griffin & Shield)",
            meaning: "ç…é·²çµåˆå‹‡æ°£èˆ‡è¦–é‡ï¼›å…‰ç›¾ä»£è¡¨å®ˆè­·ç—…äººå®‰å…¨çš„å …å®šç•Œç·šã€‚",
            // â–¼ è²¼ä¸Šæ‚¨çš„ã€å‹‡æ°£ç…é·²ã€‘å¡ç‰Œç¶²å€
            imgUrl: "https://i.ibb.co/mr8yXVYc/DALL-E-2025-12-10-23-48-55-A-vertical-trading-card-design-in-Pixar-style-titled-The-Fearless-Gua.webp"
        },
        com: {
            title: "æº«æŸ”çš„ç™‚ç™’è€…",
            eng: "The Gentle Healer",
            spirit: "ç¨è§’ç¸ (Unicorn)",
            meaning: "ç¨è§’ç¸ä»£è¡¨ç´”æ½”çš„æ²»ç™’åŠ›ï¼›å…‰èŠ’ä»£è¡¨çœ‹è¦‹äººæ€§æº«åº¦çš„åŒç†å¿ƒã€‚",
            // â–¼ è²¼ä¸Šæ‚¨çš„ã€é—œæ‡·ç¨è§’ç¸ã€‘å¡ç‰Œç¶²å€
            imgUrl: "https://i.ibb.co/d0Mjp6rT/DALL-E-2025-12-10-23-52-19-A-vertical-trading-card-design-in-Pixar-style-titled-The-Gentle-Heale.webp"
        },
        int: {
            title: "æ­£ç›´çš„å¯©åˆ¤å®˜",
            eng: "The Integrity Arbiter",
            spirit: "å¤©éµ èˆ‡ å¤©å¹³ (Swan & Scales)",
            meaning: "å¤©éµä»£è¡¨é«˜æ½”ã€ä¸æŸ“æ±¡æ³¥çš„å“æ ¼ï¼›å¤©å¹³ä»£è¡¨å…¬æ­£èˆ‡åŸå‰‡ã€‚",
            // â–¼ è²¼ä¸Šæ‚¨çš„ã€æ­£ç›´å¤©éµã€‘å¡ç‰Œç¶²å€
            imgUrl: "https://i.ibb.co/jk7Tjxp0/DALL-E-2025-12-11-00-01-31-A-vertical-trading-card-design-in-Pixar-style-titled-The-Integrity-Ar.webp"
        }
    };

    // --- éŠæˆ²é‚è¼¯ ---
    const scenarios = [
        {
            q: "ã€æƒ…å¢ƒä¸€ï¼šæ­£ç›´çš„è©¦ç…‰ã€‘çµ¦éŒ¯è—¥ä½†ç„¡å®³ï¼Œæ²’äººç™¼ç¾ã€‚ä½ æœƒï¼Ÿ",
            choices: [
                { text: "A. å‡è£æ²’äº‹", stats: { int: 1, wis: 1 } },
                { text: "B. èª å¯¦é€šå ±", stats: { int: 5, cou: 4 } },
                { text: "C. å…ˆè§€å¯Ÿç—…äºº", stats: { int: 2, wis: 3 } }
            ]
        },
        {
            q: "ã€æƒ…å¢ƒäºŒï¼šé—œæ‡·çš„é‚Šç•Œã€‘è¡—å‹ç—…äººå¤§å¼å¤§å«ä¸”æœ‰ç•°å‘³ã€‚ä½ æœƒï¼Ÿ",
            choices: [
                { text: "A. è¿…é€Ÿè™•ç†ä¸èªªè©±", stats: { com: 2, wis: 3 } },
                { text: "B. å¿è€ä¸¦æº«æŸ”å®‰æ’«", stats: { com: 5, cou: 3 } },
                { text: "C. è«‹å­¸é•·å¹«å¿™", stats: { com: 3, wis: 4 } }
            ]
        },
        {
            q: "ã€æƒ…å¢ƒä¸‰ï¼šå‹‡æ°£çš„æŒ‘æˆ°ã€‘æš´èºé†«å¸«é–‹éŒ¯åŠ‘é‡ï¼Œå­¸å§Šå«ä½ ç…§åšã€‚ä½ æœƒï¼Ÿ",
            choices: [
                { text: "A. è½è©±ç…§åš", stats: { cou: 1, wis: 2 } },
                { text: "B. ç§ä¸‹å§”å©‰è©¢å•", stats: { cou: 3, wis: 5 } },
                { text: "C. å …æŒæ‹’çµ•çµ¦è—¥", stats: { cou: 5, int: 5 } }
            ]
        },
        {
            q: "ã€æƒ…å¢ƒå››ï¼šæ™ºæ…§çš„æŠ‰æ“‡ã€‘VIPè¦å–æ°´ vs é˜¿å¬¤å‚·å£ç—›ã€‚ä½ æœƒï¼Ÿ",
            choices: [
                { text: "A. å…ˆå€’æ°´ (æ€•æŠ•è¨´)", stats: { wis: 2, com: 2 } },
                { text: "B. å…ˆçœ‹é˜¿å¬¤ (è©•ä¼°å„ªå…ˆç´š)", stats: { wis: 5, com: 4 } },
                { text: "C. è«‹åŒäº‹æ”¯æ´", stats: { wis: 4, com: 3 } }
            ]
        }
    ];

    let currentStep = 0;
    let playerStats = { wis: 0, cou: 0, com: 0, int: 0 };

    function initGame() { showQuestion(0); }

    function showQuestion(index) {
        if (index >= scenarios.length) { showResult(); return; }
        const s = scenarios[index];
        document.getElementById('scene-img').src = sceneImgs[index];
        document.getElementById('question-text').innerText = s.q;
        const cArea = document.getElementById('choices-area');
        cArea.innerHTML = '';
        s.choices.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'btn';
            btn.innerText = c.text;
            btn.onclick = () => {
                for (let key in c.stats) playerStats[key] += c.stats[key];
                currentStep++;
                showQuestion(currentStep);
            };
            cArea.appendChild(btn);
        });
    }

    function showResult() {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('result-section').style.display = 'block';
        const maxStat = Object.keys(playerStats).reduce((a, b) => playerStats[a] > playerStats[b] ? a : b);
        const result = resultData[maxStat];
        document.getElementById('final-title').innerText = result.title;
        document.getElementById('final-eng').innerText = result.eng;
        document.getElementById('spirit-name').innerText = result.spirit;
        document.getElementById('spirit-meaning').innerText = result.meaning;
        document.getElementById('final-card-img').src = result.imgUrl;
        updateBar('wis', playerStats.wis);
        updateBar('cou', playerStats.cou);
        updateBar('com', playerStats.com);
        updateBar('int', playerStats.int);
    }

    function updateBar(type, score) {
        const pct = Math.min((score / 15) * 100, 100);
        document.getElementById(`score-${type}`).innerText = score;
        setTimeout(() => { document.getElementById(`bar-${type}`).style.width = `${pct}%`; }, 100);
    }

    function showReflection() {
        document.getElementById('reflection-area').style.display = 'block';
        document.getElementById('reflection-area').scrollIntoView({ behavior: 'smooth' });
    }

    function downloadResult() {
        const element = document.getElementById("download-card");
        element.style.backgroundColor = "#0f172a"; 
        html2canvas(element, {
            useCORS: true, 
            scale: 2,
            backgroundColor: "#0f172a"
        }).then(canvas => {
            const link = document.createElement("a");
            link.download = "æˆ‘çš„è­·ç†å¸«å±¬æ€§å¡.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
        }).catch(err => {
            console.error("æˆªåœ–å¤±æ•—:", err);
            alert("åœ–ç‰‡ä¸‹è¼‰å¤±æ•—ï¼Œè«‹ç¢ºèªæ‚¨çš„åœ–ç‰‡ç¶²å€æ˜¯å¦æ”¯æ´è·¨åŸŸ(CORS)ã€‚");
        });
    }

    function copyToClipboard() {
        const text = document.getElementById('reflect-input').value;
        if (!text) { alert("è«‹å…ˆè¼¸å…¥æ‚¨çš„åæ€å…§å®¹å–”ï¼"); return; }
        navigator.clipboard.writeText(text).then(() => { alert("âœ… è¤‡è£½æˆåŠŸï¼\nè«‹å‰å¾€ TronClass è²¼ä¸Šç¹³äº¤ã€‚"); });
    }

    initGame();
</script>
</body>
</html>